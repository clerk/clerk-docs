---
title: Basic Geo Blocking
description: Learn how to add basic geo blocking to your Next.js + Clerk application.
---

Clerk does not have an out of the box geo blocking feature, but you can add a layer of protection in your Next.js middleware. Deployment platforms like Vercel and Render provide geo location data for your requests so you're able to access it at runtime and decide to allow or block a request accordingly.

## Update `clerkMiddleware()`

Update your `clerkMiddleware()` to pull in geo location data from your deployment platform of choice and then allow or block accordingly.

<Tabs items={['Vercel', 'Render']}>
  <Tab>
    ```tsx {{ filename: 'middleware.ts' }}
    import { clerkMiddleware, createRouteMatcher } from '@clerk/nextjs/server'
    import { geolocation } from '@vercel/functions'
    import { NextResponse } from 'next/server'

    const isProtectedRoute = createRouteMatcher(['/dashboard(.*)'])
    const isBlockRoute = createRouteMatcher(['/block(.*)'])

    const allowedCountries = ['US']

    export default clerkMiddleware(async (auth, req) => {
      if (isBlockRoute(req)) {
        return
      }

      // Deployed on Vercel
      // Use the x-vercel-ip-country header or the geolocation function from @vercel/functions
      // const country = req.headers.get('x-vercel-ip-country');
      const { country } = geolocation(req)

      // Redirect if we have a country code and it's not allowed
      if (country && !allowedCountries.includes(country)) {
        return NextResponse.redirect(new URL('/block', req.url))
      }

      if (isProtectedRoute(req)) await auth.protect()
    })

    export const config = {
      matcher: [
        // Skip Next.js internals and all static files, unless found in search params
        '/((?!_next|[^?]*\\.(?:html?|css|js(?!on)|jpe?g|webp|png|gif|svg|ttf|woff2?|ico|csv|docx?|xlsx?|zip|webmanifest)).*)',
        // Always run for API routes
        '/(api|trpc)(.*)',
      ],
    }
    ```
  </Tab>

  <Tab>
    ```tsx {{ filename: 'middleware.ts' }}
    import { clerkMiddleware, createRouteMatcher } from '@clerk/nextjs/server'
    import { NextResponse } from 'next/server'

    const isProtectedRoute = createRouteMatcher(['/dashboard(.*)'])
    const isBlockRoute = createRouteMatcher(['/block(.*)'])

    const allowedCountries = ['US']

    export default clerkMiddleware(async (auth, req) => {
      if (isBlockRoute(req)) {
        return
      }

      // Deployed on Render
      // Use the cf-ipcountry header
      const country = req.headers.get('cf-ipcountry')

      // Redirect if we have a country code and it's not allowed
      if (country && !allowedCountries.includes(country)) {
        return NextResponse.redirect(new URL('/block', req.url))
      }

      if (isProtectedRoute(req)) await auth.protect()
    })

    export const config = {
      matcher: [
        // Skip Next.js internals and all static files, unless found in search params
        '/((?!_next|[^?]*\\.(?:html?|css|js(?!on)|jpe?g|webp|png|gif|svg|ttf|woff2?|ico|csv|docx?|xlsx?|zip|webmanifest)).*)',
        // Always run for API routes
        '/(api|trpc)(.*)',
      ],
    }
    ```
  </Tab>
</Tabs>
