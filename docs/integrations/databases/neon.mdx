---
title: Integrate Neon Postgres with Clerk
description: Learn how to integrate Clerk into your Neon application.
---

# Integrate Neon with Clerk 

## Set up a Clerk application

The first step is to create a new Clerk application from your [Clerk Dashboard](https://dashboard.clerk.com/) if you haven't done so already. You can choose whichever authentication strategy and social sign-in providers you prefer. For more information, check out the [Set up your application](/docs/quickstarts/setup-clerk) guide.

After your Clerk application has been created, in the Clerk Dashboard, navigate to the **[API keys](https://dashboard.clerk.com/last-active?path=api-keys)** page. From the `Quick Copy` section, select the framework as `Next.js` and copy both the `NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY` and `CLERK_SECRET_KEY` values.
You'll need this to configure Clerk in your Next.js application.

<Images
  width={3024}
  height={1648} 
  src="/docs/images/integrations/frontend-api.webp"
  alt="The API keys page in the Clerk Dashboard. There is a Quick Copy section to copy the relevant Clerk keys as environment variables to your project."
/>

## Set up your Neon database 

Log in to the [Neon console](https://console.neon.tech/) and create a new project or select an existing one. Navigate to the **Connection Details** section to find your Neon database connection string. Keep this connection string handy for later use. 

<Images
    width={3024}
    height={1648} 
    src="/docs/images/integrations/neon-connection-string.png"
    alt="The connection details page in the Neon console. The connection string is highlighted."
/>

## Create a new Next.js project

Create a new Next.js project using the following command:

```bash
npx create-next-app example-neon-clerk --typescript --eslint --tailwind --use-npm --no-src-dir --app --import-alias "@/*"
```

Navigate to the project directory and install the required dependencies:

```bash
npm install @clerk/nextjs
npm install @neondatabase/serverless drizzle-orm dotenv
npm install -D drizzle-kit
```

Create a `.env.local` file in the project root to store the Neon connection string and the Clerk API keys you fetched earlier:

```bash
# .env.local

DATABASE_URL=NEON_DB_CONNECTION_STRING
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=**************  
CLERK_SECRET_KEY=**************
```

## Implement your application

We create a simple application that allows users to add and delete quotes. If the user already has a quote, they can view it (and choose to remove it); if not, they can add a new one.

### Set up the application schema

Create a `db` folder inside the `app/` directory with the following files to define your database connection and schema:

```typescript
/// app/db/index.ts

import "dotenv/config";
import { neon } from "@neondatabase/serverless";  
import { drizzle } from "drizzle-orm/neon-http";
import { UserMessages } from "./schema";

if (!process.env.DATABASE_URL) {
  throw new Error("DATABASE_URL must be a Neon postgres connection string");
}

const sql = neon(process.env.DATABASE_URL);
export const db = drizzle(sql, {  
  schema: { UserMessages },
});
```

```typescript 
/// app/db/schema.ts

import { pgTable, text, timestamp } from "drizzle-orm/pg-core";

export const UserMessages = pgTable("user_messages", {
  user_id: text("user_id").primaryKey().notNull(),
  createTs: timestamp("create_ts").defaultNow().notNull(), 
  message: text("message").notNull(),
});
```

Also, create a `drizzle.config.ts` file in the root of your project and add the following content:

```typescript
/// drizzle.config.ts

import { defineConfig } from "drizzle-kit";
import * as dotenv from "dotenv";

dotenv.config({ path: ".env.local" });

export default defineConfig({
  dialect: "postgresql",
  dbCredentials: {
    url: process.env.DATABASE_URL!,
  },
  schema: "./app/db/schema.ts",
  out: "./migrations",
});
```

Generate and run the database migrations by running the following commands:

```bash
npx drizzle-kit generate
npx drizzle-kit migrate
```

### Configure Clerk authentication 

Wrap your Next.js app with the `ClerkProvider` component in `app/layout.tsx`:  

```tsx
/// app/layout.tsx

import type { Metadata } from "next";
import { Inter } from "next/font/google";
import "./globals.css";
import { ClerkProvider, UserButton } from "@clerk/nextjs";

const inter = Inter({ subsets: ["latin"] });

export const metadata: Metadata = {
  title: "Neon-Clerk guide",
  description: "Generated by create next app",
};

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    <ClerkProvider>
      <html lang="en">
        <body className={inter.className}>
          <div className="p-4 bg-white">
            <UserButton showName={true}></UserButton>
          </div>
          {children}
        </body>
      </html>
    </ClerkProvider>
  );
}
```

Add the Clerk authentication middleware in `middleware.ts`:

```typescript
/// app/middleware.ts 

import { clerkMiddleware } from "@clerk/nextjs/server";

export default clerkMiddleware((auth, _req) => {
    auth().protect();
});

export const config = {
  matcher: [ '/((?!.*\\..*|_next).*)', '/', '/(api|trpc)(.*)'],
};  
```

### Implement your application

Create server actions to handle form submissions and database interactions:

```typescript
/// app/actions.ts

"use server";

import { currentUser } from "@clerk/nextjs/server";
import { UserMessages } from "./db/schema"; 
import { db } from "./db";
import { redirect } from "next/navigation";
import { eq } from "drizzle-orm";

export async function createUserMessage(formData: FormData) {
  const user = await currentUser();
  if (!user) throw new Error("User not found");
  
  const message = formData.get("message") as string;
  await db.insert(UserMessages).values({
    user_id: user.id,
    message,  
  });
  redirect("/");
}

export async function deleteUserMessage() {
  const user = await currentUser();
  if (!user) throw new Error("User not found");

  await db.delete(UserMessages).where(eq(UserMessages.user_id, user.id));
  redirect("/");
}
```

Implement the UI in `app/page.tsx`:

```tsx
/// app/page.tsx

import { createUserMessage, deleteUserMessage } from "./actions";
import { db } from "./db";
import { currentUser } from "@clerk/nextjs/server";

async function getUserMessage() {
  const user = await currentUser();
  if (!user) throw new Error("User not found");
  return db.query.UserMessages.findFirst({
    where: (messages, { eq }) => eq(messages.user_id, user.id),
  });
}

export default async function Home() {
  const existingMessage = await getUserMessage();

  return (
    <main className="flex flex-col items-center justify-center min-h-screen">
      <h1 className="text-3xl font-bold mb-8">Neon + Clerk Example</h1>
      {existingMessage ? (
        <div className="text-center">
          <p className="text-xl mb-4">{existingMessage.message}</p>
          <form action={deleteUserMessage}>
            <button type="submit" className="bg-red-500 text-white px-4 py-2 rounded">
              Delete Message
            </button>
          </form>
        </div>
      ) : (
        <form action={createUserMessage} className="flex flex-col items-center">
          <input type="text" name="message" placeholder="Enter a message" className="border border-gray-300 rounded px-4 py-2 mb-4 w-64" />
          <button type="submit" className="bg-blue-500 text-white px-4 py-2 rounded">
            Save Message
          </button>
        </form>
      )}
    </main>
  );
}
```

## Run the application 

Start the Next.js development server:

```bash
npx next dev
```

Open `http://localhost:3000` in your browser. Sign in with Clerk and interact with the application to add and delete user messages.

## Next steps

- Add more routes and features to your application. The Clerk middleware ensures only authenticated users can access protected routes.
- Manage your application's users from the [Clerk Dashboard](https://dashboard.clerk.com/).
