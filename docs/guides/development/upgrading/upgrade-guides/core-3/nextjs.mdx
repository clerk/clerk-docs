---
description: "Prepare Next.js apps for Clerk Core 3."
title: "Upgrading `@clerk/nextjs` to Core 3"
---

Core 3 for Next.js tightens platform requirements, removes deprecated redirect props, and introduces a new client-side authorization component. Use this guide to prepare before installing `@clerk/nextjs@latest`.

## Preparing to upgrade

- **Node.js**: Use Node `20.9.0` or newer. Older runtimes are no longer supported.
- **Next.js**: Use Next.js `15.2.3` or newer. Support for Next 13 and 14 has been dropped.
- **React**: React 18+ remains required.

## Updating to Core 3

Install the latest SDK:

```npm
npm install @clerk/nextjs
```

## CLI upgrade helper

The `@clerk/upgrade` CLI now understands Core 3 changes and ships a `transform-protect-to-show` codemod.

```npm
npx @clerk/upgrade --from=core-2
```

The codemod migrates client-side `<Protect>` usage to `<Show>` and updates imports automatically. Use the previous CLI major if you must target an older Clerk release.

## Breaking changes

### Authorization components

- `<Protect>` is now limited to App Router server usage.
- Use the new `<Show when={...}>` component for client-side authorization checks.

Example migration:

```tsx
'use client'

import { Show } from '@clerk/nextjs'

export default function DashboardGate({ children }) {
  return <Show when={{ role: 'org:admin' }}>{children}</Show>
}
```

For server components and Middleware, continue using `auth().protect` or `clerkMiddleware`.

### Middleware encryption key

When you pass `secretKey` to `clerkMiddleware` at runtime you must also provide `CLERK_ENCRYPTION_KEY` in the environment. Missing keys now throw an error during startup.

### Removed deprecated props and helpers

Core 3 removes the redirect and UI props that were deprecated in Core 2:

- `afterSignInUrl`, `afterSignUpUrl`, and `redirectUrl` props are removed. Use the Core 2 redirect options (for example `signInFallbackRedirectUrl` or `signInForceRedirectUrl`) or handle redirects in Middleware.
- `UserButton` sign-out override props are removed. Use the redirect options instead.
- Organization `hideSlug` flags and `OrganizationSwitcher` `afterSwitchOrganizationUrl` are removed; rely on the default UI or navigate in an `onOrganizationSwitched` handler.
- `Client.activeSessions`, `setActive({ beforeEmit })`, and the `ClerkMiddlewareAuthObject` type alias are no longer exported.

### Internal API prefix changes

Experimental and unstable APIs were renamed for consistency. For Next.js, rename `__unstable_invokeMiddlewareOnAuthStateChange` to `__internal_invokeMiddlewareOnAuthStateChange`. Other `__unstable*` and `experimental*` exports in `@clerk/*` packages now use the `__internal` or `__experimental` prefixes.
