---
title: Fastify Quickstart
description: Learn how to integrate Clerk for secure authentication and user management into your application using a Fastify backend.
---

<TutorialHero
  framework="react"
  exampleRepo={[
    {
      title: "Fastify Quickstart",
      link: "https://github.com/clerk/clerk-fastify-quickstart"

    }
  ]}
  beforeYouStart={[
    {
      title: "Set up a Clerk application",
      link: "/docs/quickstarts/setup-clerk",
      icon: "clerk",
    },    {
      title: "Add Fastify as your backend",
      link: "https://fastify.dev/docs/latest/Guides/Getting-Started",
      icon: "fastify",
    }
  ]}
>
  - Create a Clerk application
  - Install `@clerk/fastify`
  - Set your Clerk API keys
  - Configure `clerkPlugin` for all routes
  - Use `getAuth()` to access the auth state and protect routes
  - Configure `clerkPlugin` for specific routes
</TutorialHero>

Learn how to integrate Clerk into your Fastify backend for secure user authentication and management. This guide uses TypeScript and allows you to choose your frontend framework.

> [!IMPORTANT]
> [Fastify is only compatible with Next.js versions 13.4 and below](https://github.com/fastify/fastify-nextjs). If you're using a newer version of Next.js, consider using a different backend framework that supports the latest Next.js features.
>
> This guide uses ECMAScript Modules (ESM). To use ESM in your project, you must include `"type": "module"` in your `package.json`.

> [!NOTE]
> If you're using ECMAScript Modules (ESM) in your project, you must include `"type": "module"` in your `package.json` to enable ESM support in Node.js.

<Steps>
  ### Install `@clerk/fastify`

  [Clerk's Fastify SDK](https://github.com/clerk/javascript/tree/main/packages/fastify) has prebuilt components, React hooks, and helpers to make user authentication easier.

  To get started using Clerk with Fastify, add the SDK to your project:

  <CodeBlockTabs options={["npm", "yarn", "pnpm"]}>
    ```bash {{ filename: 'terminal' }}
    npm install @clerk/fastify

    ```

    ```bash {{ filename: 'terminal' }}
    yarn add @clerk/fastify
    ```

    ```bash {{ filename: 'terminal' }}
    pnpm add @clerk/fastify
    ```
  </CodeBlockTabs>

  ### Set your Clerk API keys

  <SignedIn>
    Add the following keys to your `.env.local` file. These keys can always be retrieved from the [API Keys](https://dashboard.clerk.com/last-active?path=api-keys) page of your Clerk Dashboard.
  </SignedIn>

  <SignedOut>
    1. Navigate to the Clerk Dashboard.
    1. In the navigation sidebar, select [API Keys](https://dashboard.clerk.com/last-active?path=api-keys).
    1. In the **Quick Copy** section, copy your Clerk publishable and secret key.
    1. Paste your keys into your `.env` file.

    The final result should resemble the following:
  </SignedOut>

  ```env {{ filename: '.env' }}
  CLERK_PUBLISHABLE_KEY={{pub_key}}
  CLERK_SECRET_KEY={{secret}}
  ```

  ### Configure `clerkPlugin` for all routes

  The `clerkPlugin` is a plugin that integrates authentication into your Fastify application. You can configure it to either secure all routes or apply authentication to specific ones.

  The following example registers the plugin for all routes. To register the plugin for specific routes only, refer to the [**Using Clerk for specific pages only**](/docs/quickstarts/fastify#using-clerk-for-specific-routes-only) section.

  > [!IMPORTANT]
  > The `dotenv/config` module must be imported before any Clerk modules. This order is important because Clerk instances are created during the import process and rely on environment variables, such as API keys, to be initialized correctly. For more details, refer to the [Fastify docs](https://fastify.dev/docs/latest/Guides/Getting-Started/#loading-order-of-your-plugins).

  ```ts {{ filename: 'index.ts' }}
  import 'dotenv/config'
  import Fastify from 'fastify'
  import { clerkPlugin } from '@clerk/fastify'

  const fastify = Fastify({ logger: true })

  fastify.register(clerkPlugin)

  const start = async () => {
    try {
      await fastify.listen({ port: 8080 })
    } catch (error) {
      fastify.log.error(error)
      process.exit(1)
    }
  }

  start()
  ```

  ### Use `getAuth()` to access the auth state and protect routes

  The `getAuth()` helper retrieves the authentication state from the current request.

  [`clerkClient`](/docs/references/backend/overview) is an instance of Clerk's JavaScript Backend SDK, which provides access to Clerk's Backend API resources and low-level  utilities for handling authentication in JavaScript environments.

  The following example uses `getAuth()` to retrieve the `userId`, which is used to protect the route and is passed to `clerkClient.users.getUser()` to retrieve the current user's `User` object.

  ```ts {{ filename: 'index.ts', mark: [3, [9, 17]] }}
  import 'dotenv/config'
  import Fastify from 'fastify'
  import { clerkClient, clerkPlugin, getAuth } from '@clerk/fastify'

  const fastify = Fastify({ logger: true })

  fastify.register(clerkPlugin)

  fastify.get('/', async (request, reply) => {
    const { userId } = getAuth(request)
    const user = userId ? await clerkClient.users.getUser(userId) : null

    return reply.send({
      message: 'Authentication state retrieved successfully.',
      user,
    })
  })

  const start = async () => {
    try {
      await fastify.listen({ port: 8080 })
    } catch (error) {
      fastify.log.error(error)
      process.exit(1)
    }
  }

  start()
  ```

  To protect a route using Clerk, use the `getAuth()` method to check if the user is authenticated. If not, it returns an error response. If authenticated, it retrieves the user information using `clerkClient`.

  ```ts {{ filename: 'index.ts' }}
  fastify.get('/protected', async (request, reply) => {
    try {
      const { userId } = getAuth(request)

      if (!userId) {
        return reply.code(403).send({ error: 'Unauthorized request.' })
      }

      const user = await clerkClient.users.getUser(userId)

      return reply.send({
        message: 'Authentication state retrieved successfully.',
        user,
      })
    } catch (error) {
      fastify.log.error(error)
      return reply.code(500).send({ error: 'Failed to retrieve user information.' })
    }
  })
  ```
</Steps>

### Configure `clerkPlugin` for specific routes

If you want to use Clerk for specific pages only, you can register the plugin for specific routes. In the following example, the routes are split into public and private routes.

```ts {{ filename: 'index.ts' }}
import 'dotenv/config'
import Fastify, { FastifyPluginCallback } from 'fastify'
import { clerkClient, clerkPlugin, getAuth } from '@clerk/fastify'

const fastify = Fastify({ logger: true })

const protectedRoutes: FastifyPluginCallback = (instance, options, done) => {
  instance.register(clerkPlugin)

  instance.get('/protected', async (request, reply) => {
    const { userId } = getAuth(request)
    if (!userId) {
      return reply.code(403).send({ message: 'Access denied. Authentication required.' })
    }

    const user = await clerkClient.users.getUser(userId)

    // Only authenticated users will see the following message
    reply.send({ message: 'This is a protected route.' })
    return { user }
  })

  done()
}

const publicRoutes: FastifyPluginCallback = (instance, options, done) => {
  instance.get('/', async (request, reply) => {
    return { message: 'This is a public route.' }
  })

  done()
}

fastify.register(protectedRoutes)
fastify.register(publicRoutes)

const start = async () => {
  try {
    await fastify.listen({ port: 8080 })
  } catch (error) {
    fastify.log.error(error)
    process.exit(1)
  }
}

start()
```
