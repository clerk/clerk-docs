---
title: Steps after sign-up/sign-in (after-auth flows)
description: Learn how to configure your application to require users to complete specific actions after signing up or signing in.
---

You can configure your application to require users to complete specific actions after signing up or signing in. Clerk refers to these steps as **after-auth flows**. Users who don't complete these required actions will have their session remain in a `pending` status, which, by default, is treated as a signed-out state.

Once you have enabled an after-auth flow through the Clerk Dashboard, no further configuration or code is required. After-auth flows are embedded within the `<SignIn />` and `<SignUp>` components out-of-the-box. Currently, you cannot eject the after-auth flows to custom pages, but we're working on adding this capability.

## Available after-auth flows

The following after-auth flows are available:

- [Disable personal workspaces](/docs/organizations/overview#disable-personal-workspaces)

## `pending` sessions

A user's authentication state can be considered signed-in, signed-out, or pending. By default, **`pending` sessions are treated as signed-out** across control components and utilities. See the following sections for more information.

### Control components

Control components manage authentication-related behaviors in your application. They handle tasks such as controlling content visibility based on user authentication status, managing loading states during authentication processes, and redirecting users to appropriate pages.

The following examples demonstrate how the different control components respond to `pending` sessions.

<Tabs items={['<Protect />', '<SignedOut />', '<SignedIn />']}>
  <Tab>
    The [`<Protect />`](/docs/components/protect) component protects content or even entire routes based on a user's authentication state. It will render its children if the user's state is signed-in. It accepts a `fallback` prop that will be rendered if the user's state is signed-out.

    In the following example, if the user's state is `pending`, they will see the `fallback` content because, by default, `pending` sessions are treated as signed-out.

    ```tsx
    export default function Page() {
      return (
        <Protect fallback={<p>Signed-out and pending users can see this.</p>}>
          <p>Only signed-in users can see this.</p>
        </Protect>
      )
    }
    ```
  </Tab>

  <Tab>
    The [`<SignedOut />`](/docs/components/signed-out) component renders its children if the user's authentication state is signed-out.

    In the following example, if the user's state is `pending`, they **will** see the content of the component because, by default, `pending` sessions are treated as signed-out.

    ```tsx
    export default function Page() {
      return (
        <SignedOut>
          <p>Users that are signed-out or pending will see this.</p>
        </SignedOut>
      )
    }
    ```
  </Tab>

  <Tab>
    The [`<SignedIn />`](/docs/components/signed-in) component renders its children if the user's authentication state is signed-in.

    In the following example, if the user's state is `pending`, they **won't** see the content of the component because, by default, `pending` sessions are treated as signed-out.

    ```tsx
    export default function Page() {
      return (
        <SignedIn>
          <p>Users that are signed-in will see this.</p>
        </SignedIn>
      )
    }
    ```
  </Tab>
</Tabs>

Control components accept a `treatPendingAsSignedOut` prop, which defaults to `true`. You can pass `false` to opt-out of this behavior and treat `pending` sessions as signed-in.

<Tabs items={['<Protect />', '<SignedOut />', '<SignedIn />']}>
  <Tab>
    The [`<Protect />`](/docs/components/protect) component accepts a `treatPendingAsSignedOut` prop, which defaults to `true`. You can pass `false` to opt-out of this behavior and treat `pending` sessions as signed-in.

    In the following example, if the user's state is `pending`, they will see the protected content because `treatPendingAsSignedOut` is set to `false`.

    ```tsx
    export default function Page() {
      return (
        <Protect
          treatPendingAsSignedOut={false}
          fallback={<p>Users that are signed-out can see this.</p>}
        >
          <p>Users that are signed-in or pending can see this.</p>
        </Protect>
      )
    }
    ```
  </Tab>

  <Tab>
    The [`<SignedOut />`](/docs/components/signed-out) component renders its children if the user's authentication state is signed-out.

    In the following example, if the user's state is `pending`, they **won't** see the content of the component because `treatPendingAsSignedOut` is set to `false`.

    ```tsx
    export default function Page() {
      return (
        <SignedOut treatPendingAsSignedOut={false}>
          <p>Users that are signed-out will see this.</p>
        </SignedOut>
      )
    }
    ```
  </Tab>

  <Tab>
    The [`<SignedIn />`](/docs/components/signed-in) component renders its children if the user's authentication state is signed-in.

    In the following example, if the user's state is `pending`, they **will** see the content of the component because `treatPendingAsSignedOut` is set to `false`.

    ```tsx
    export default function Page() {
      return (
        <SignedIn>
          <p>Users that are signed-in or pending will see this.</p>
        </SignedIn>
      )
    }
    ```
  </Tab>
</Tabs>

### Server-side protections

Once a user's session is in a `pending` state, server utilities, such as [`useAuth()`](/docs/hooks/use-auth) and [`auth()`](/docs/references/nextjs/auth), treat the session as signed-out by default. Those utilities accept a `treatPendingAsSignedOut` option that defaults to `true`. You can pass `false` to opt-out of this behavior and treat `pending` sessions as signed-in.

#### Example: Disable personal workspaces

For example, if you've enabled the [disable personal workspaces](/docs/organizations/overview#disable-personal-workspaces) after-auth flow in the Clerk Dashboard, your users will be required to select or create an organization after signing up or signing in. If they haven't, their session will be in a `pending` state. Any pages that are protected using Clerk's protection utilities will treat the user's session as signed-out.

For `auth.protect()`, it would redirect `pending` users to the organization selection page so they can fulfill the after-auth requirements, and move their session to a `signed-in` state.

```tsx {{ filename: 'middleware.ts' }}
import { clerkMiddleware, createRouteMatcher } from '@clerk/nextjs/server'

const isProtectedRoute = createRouteMatcher(['/dashboard(.*)', '/forum(.*)'])

export default clerkMiddleware(async (auth, req) => {
  // pending users won't be able to access protected routes
  // and will be redirected to the organization selection page
  if (isProtectedRoute(req)) await auth.protect()
})
```

For `auth.userId()`, it would return `null` if the user has a `pending` session. In the following example, the user will be redirected to the sign-in page

{/* TODO: Test and finish writing */}

```tsx {{ filename: 'app/middleware.ts' }}
import { clerkMiddleware, createRouteMatcher } from '@clerk/nextjs/server'

const isProtectedRoute = createRouteMatcher(['/dashboard(.*)', '/forum(.*)'])

export default clerkMiddleware(async (auth, req) => {
  const { userId, redirectToSignIn } = await auth()

  // `userId` won't be available if the user has a pending session
  // without an organization
  if (!userId && isProtectedRoute(req)) {
    return redirectToSignIn()
  }
})
```

For `auth().userId`, it would return `null` if the user has a `pending` session.

{/* TODO: Test and finish writing */}

```tsx {{ filename: 'app/page.tsx' }}
import { auth } from '@clerk/nextjs/server'

export default async function Page() {
  const { userId, orgId } = await auth()

  if (!userId) {
    return (
      <p>
        User has no session or a pending session meaning that it might not have an organization
        selected
      </p>
    )
  }

  return (
    <p>
      <p>User has a valid session and {orgId} is defined</p>
    </p>
  )
}
```
