---
title: Astro Hybrid Rendering
description: Clerk supports Astro in hybrid/static mode out-of-the-box.
---

<TutorialHero
  framework="astro"
  beforeYouStart={[
    {
      title: "Set up a Clerk application",
      link: "/docs/quickstarts/setup-clerk",
      icon: "clerk",
    },
    {
      title: "Create a Astro application",
      link: "https://docs.astro.build/en/install-and-setup",
      icon: "astro",
    },
  ]}
>
  - Install `@clerk/astro`
  - Set up your environment keys to test your app locally
  - Add TypeScript declarations
  - Add the `clerk()` integration to your application
  - Use Clerk middleware to implement route-specific authentication
  - Create a header with Clerk components for users to sign in and out
</TutorialHero>

> [!NOTE]
> This guide explains how to use Clerk with [Astro in Hybrid mode](https://docs.astro.build/en/guides/server-side-rendering/#configure-server-or-hybrid).
> If you are using Astro in server-only mode, follow the [Clerk quickstart](/docs/quickstarts/astro).

Clerk's [Astro SDK](/docs/references/astro/overview) provides a set of components, hooks, and stores that make it easy to build authentication and user management features in your Astro app.

<Steps>
  ### Install `@clerk/astro`

  Add Clerk's Astro SDK to your project:

  <CodeBlockTabs type="installer" options={["npm", "yarn", "pnpm"]}>
    ```bash {{ filename: 'terminal' }}
    npm install @clerk/astro
    ```

    ```bash {{ filename: 'terminal' }}
    yarn add @clerk/astro
    ```

    ```bash {{ filename: 'terminal' }}
    pnpm add @clerk/astro
    ```
  </CodeBlockTabs>

  ### Set environment variables

  <SignedIn>
    Add the following keys to your `.env.local` file. These keys can always be retrieved from the [API Keys](https://dashboard.clerk.com/last-active?path=api-keys) page of your Clerk Dashboard.
  </SignedIn>

  <SignedOut>
    1. Navigate to the Clerk Dashboard.
    1. In the navigation sidebar, select [API Keys](https://dashboard.clerk.com/last-active?path=api-keys).
    1. In the **Quick Copy** section, copy your Clerk publishable and secret key.
    1. Paste your keys into your `.env.local` file.

    > [!IMPORTANT]
    > You don't need a secret key if your app is fully-prerendered.

    The final result should resemble the following:
  </SignedOut>

  ```env {{ filename: '.env' }}
  PUBLIC_CLERK_PUBLISHABLE_KEY={{pub_key}}
  CLERK_SECRET_KEY={{secret}}
  ```

  ### Update `astro.config.mjs`

  To configure Clerk in your astro application, you will need to update your `astro.config.mjs`.

  - Add the Clerk integration to the `integrations` list.
  - Install an [SSR adapter](https://docs.astro.build/en/guides/server-side-rendering/#official-adapters). This is required if you opt-out of prerendering. For this quickstart we chose the [`@astrojs/node`](https://docs.astro.build/en/guides/integrations-guide/node/) adapter. You can use any Node based adapter you wish.
  - Set `output` to `hybrid`. This is required when you want static pages or the full flexibility of server rendering for each page.

  ```ts {{ filename: 'astro.config.mjs', mark: [2, 3, [6, 8]] }}
  import { defineConfig } from 'astro/config'
  import node from '@astrojs/node'
  import clerk from '@clerk/astro'

  export default defineConfig({
    integrations: [clerk()],
    adapter: node({ mode: 'standalone' }),
    output: 'hybrid',
  })
  ```

  ### Add middleware to your application

  > [!IMPORTANT]
  > You can skip this step if your app is fully-prerendered.

  [`clerkMiddleware()`](/docs/references/astro/clerk-middleware) grants you access to user authentication state throughout your application, on any route or page. It also allows you to protect specific routes from unauthenticated users. To add `clerkMiddleware()` to your application, follow these steps:

  1. Create a `middleware.ts` file inside your `src/` directory.
  1. In your `middleware.ts` file, export an `onRequest` constant and assign the result of the `clerkMiddleware` function to it.

     ```tsx {{ filename: 'src/middleware.ts' }}
     import { clerkMiddleware } from '@clerk/astro/server'

     export const onRequest = clerkMiddleware()
     ```
  1. By default, `clerkMiddleware()` will not protect any routes. All routes are public and you must opt-in to protection for routes. See the [`clerkMiddleware()` reference](/docs/references/astro/clerk-middleware) to learn how to require authentication for specific routes.

  ### Add TypeScript declarations

  Update the `env.d.ts` file in your `src/` directory to add type definitions for the `locals` added by the middleware.

  ```ts {{ prettier: false, filename: 'src/env.d.ts', mark: [3] }}
  /// <reference types="astro/client" />
  /// <reference types="@clerk/astro/env" />
  ```

  ### Add components to your app

  Clerk offers components that allow you to protect your pages. These components are used to control the visibility of your pages based on the user's authentication state.

  <Tabs items={["Prerendered", "Opt-out"]}>
    <Tab>
      ```astro {{ filename: 'src/pages/index.astro' }}
      ---
      import SiteLayout from '../layouts/SiteLayout.astro'
      import { SignedIn, SignedOut, UserButton } from '@clerk/astro/components'

      export const prerender = true
      ---

      <SiteLayout>
        <SignedOut>
          <SignInButton mode="modal" />
        </SignedOut>
        <SignedIn>
          <UserButton />
        </SignedIn>
      </SiteLayout>
      ```
    </Tab>

    <Tab>
      > [!WARNING]
      > If you opt-out of prerendering, you must set the `isStatic` prop to `false` on the `SignedIn`, `SignedOut`, and `Protect` components.

      ```astro {{ filename: 'src/pages/index.astro' }}
      ---
      import SiteLayout from '../layouts/SiteLayout.astro'
      import { SignedIn, SignedOut, UserButton } from '@clerk/astro/components'

      export const prerender = false
      ---

      <SiteLayout>
        <SignedOut isStatic={false}>
          <SignInButton mode="modal" />
        </SignedOut>
        <SignedIn isStatic={false}>
          <UserButton />
        </SignedIn>
      </SiteLayout>
      ```
    </Tab>
  </Tabs>
</Steps>

## Next steps

<Cards>
  - [Protect routes using Clerk Middleware](/docs/references/astro/clerk-middleware)
  - Learn how to protect specific routes from unauthenticated users.

  ---

  - [Read session and user data](/docs/references/astro/read-session-data)
  - Learn how to use Clerk's stores and helpers to access the active session and user data in your Astro application.

  ---

  - [Clerk + Astro Quickstart Repo](https://github.com/clerk/clerk-astro-quickstart)
  - The official companion repo for Clerk's Astro Quickstart.
</Cards>
