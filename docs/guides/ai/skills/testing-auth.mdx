---
title: Testing auth skill
description: Write E2E tests for Clerk-authenticated apps with Playwright or Cypress.
---

The `testing-auth` skill helps AI agents set up end-to-end testing for Clerk-authenticated applications using Playwright or Cypress.

## Installation

Install the skill:

```bash
npx add-skill clerk/skills --skill testing-auth
```

Install the testing package:

```bash
npm install @clerk/testing --save-dev
```

## Example prompts

- "Add Playwright tests for authentication"
- "Set up Cypress with Clerk"
- "Test the sign-in flow"
- "Add E2E tests for protected routes"

## Environment variables

```bash {{ filename: '.env.test' }}
E2E_CLERK_USER_USERNAME=test@example.com
E2E_CLERK_USER_PASSWORD=your-test-password
```

## Common patterns

### Playwright setup

```ts {{ filename: 'playwright.config.ts' }}
import { defineConfig } from '@playwright/test'

export default defineConfig({
  use: {
    baseURL: 'http://localhost:3000',
  },
  projects: [
    {
      name: 'setup',
      testMatch: /global\.setup\.ts/,
    },
    {
      name: 'tests',
      dependencies: ['setup'],
      use: {
        storageState: 'playwright/.clerk/user.json',
      },
    },
  ],
})
```

### Global setup (Playwright)

```ts {{ filename: 'tests/global.setup.ts' }}
import { clerkSetup } from '@clerk/testing/playwright'
import { test as setup } from '@playwright/test'

setup('authenticate', async ({ page }) => {
  await clerkSetup({
    page,
    signInParams: {
      strategy: 'password',
      identifier: process.env.E2E_CLERK_USER_USERNAME!,
      password: process.env.E2E_CLERK_USER_PASSWORD!,
    },
    savePath: 'playwright/.clerk/user.json',
  })
})
```

### Auth test (Playwright)

```ts {{ filename: 'tests/dashboard.spec.ts' }}
import { setupClerkTestingToken } from '@clerk/testing/playwright'
import { test, expect } from '@playwright/test'

test('dashboard requires authentication', async ({ page }) => {
  await setupClerkTestingToken({ page })

  await page.goto('/dashboard')
  await expect(page).toHaveURL('/dashboard')
  await expect(page.locator('[data-clerk-loaded="true"]')).toBeVisible()
})
```

### Cypress setup

```ts {{ filename: 'cypress/support/e2e.ts' }}
import { addClerkCommands } from '@clerk/testing/cypress'

addClerkCommands({ Cypress, cy })
```

### Auth test (Cypress)

```ts {{ filename: 'cypress/e2e/dashboard.cy.ts' }}
describe('Dashboard', () => {
  beforeEach(() => {
    cy.clerkSignIn({
      strategy: 'password',
      identifier: Cypress.env('E2E_CLERK_USER_USERNAME'),
      password: Cypress.env('E2E_CLERK_USER_PASSWORD'),
    })
  })

  it('shows dashboard for authenticated users', () => {
    cy.visit('/dashboard')
    cy.get('[data-clerk-loaded="true"]').should('be.visible')
  })
})
```

## Key concepts

1. **Bot detection bypass**: Call `setupClerkTestingToken()` before navigating to auth pages
2. **Auth state persistence**: Save session to `storageState` for faster tests
3. **Test instance keys**: Use `pk_test_...` and `sk_test_...` keys

## Common pitfalls

- **Call `setupClerkTestingToken()` first** - before navigating to auth pages
- **Use test instance keys** - not production keys
- **Save auth state** - use `storageState` for faster test runs
- **Wait for Clerk to load** - check `[data-clerk-loaded="true"]`
- **Cypress setup** - add `addClerkCommands({ Cypress, cy })` to support file

## Related skills

- [adding-auth](/docs/guides/ai/skills/adding-auth) - Basic auth setup (prerequisite)

## Source code

View the skill source on [GitHub](https://github.com/clerk/skills/tree/main/skills/testing-auth).
