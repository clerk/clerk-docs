```kotlin {{ filename: 'MFASignInViewModel.kt', collapsible: true }}
import androidx.lifecycle.ViewModel
import androidx.lifecycle.viewModelScope
import com.clerk.api.Clerk
import com.clerk.api.network.serialization.onFailure
import com.clerk.api.network.serialization.onSuccess
import com.clerk.api.signin.SignIn
import com.clerk.api.signin.attemptSecondFactor
import kotlinx.coroutines.flow.MutableStateFlow
import kotlinx.coroutines.flow.asStateFlow
import kotlinx.coroutines.launch

class MFASignInViewModel : ViewModel() {
    private val _uiState = MutableStateFlow<UiState>(UiState.Unverified)
    val uiState = _uiState.asStateFlow()

    fun submit(email: String, password: String) {
    viewModelScope.launch {
        SignIn.create(SignIn.CreateParams.Strategy.Password(identifier = email, password = password))
        .onSuccess {
            if (it.status == SignIn.Status.NEEDS_SECOND_FACTOR) {
            // Display TOTP Form
            _uiState.value = UiState.NeedsSecondFactor
            } else {
            // If the status is not needsSecondFactor, check why. User may need to
            // complete different steps.
            }
        }
        .onFailure {
            // See https://clerk.com/docs/guides/development/custom-flows/error-handling
            // for more info on error handling
        }
    }
    }

    fun verify(code: String) {
    val inProgressSignIn = Clerk.signIn ?: return
    viewModelScope.launch {
        inProgressSignIn
        .attemptSecondFactor(SignIn.AttemptSecondFactorParams.TOTP(code))
        .onSuccess {
            if (it.status == SignIn.Status.COMPLETE) {
                // User is now signed in and verified.
                // You can navigate to the next screen or perform other actions.
            _uiState.value = UiState.Verified
            }
        }
        .onFailure {
            // See https://clerk.com/docs/guides/development/custom-flows/error-handling
            // for more info on error handling
        }
    }
    }

    sealed interface UiState {
    data object Unverified : UiState
    data object Verified : UiState
    data object NeedsSecondFactor : UiState
    }
}
```

```kotlin {{ filename: 'MFASignInActivity.kt', collapsible: true }}
import android.os.Bundle
import androidx.activity.ComponentActivity
import androidx.activity.compose.setContent
import androidx.activity.viewModels
import androidx.compose.foundation.layout.Arrangement
import androidx.compose.foundation.layout.Column
import androidx.compose.foundation.layout.fillMaxSize
import androidx.compose.material3.Button
import androidx.compose.material3.Text
import androidx.compose.material3.TextField
import androidx.compose.runtime.Composable
import androidx.compose.runtime.getValue
import androidx.compose.runtime.mutableStateOf
import androidx.compose.runtime.remember
import androidx.compose.runtime.setValue
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.text.input.PasswordVisualTransformation
import androidx.compose.ui.unit.dp
import androidx.lifecycle.compose.collectAsStateWithLifecycle

class MFASignInActivity : ComponentActivity() {
  val viewModel: MFASignInViewModel by viewModels()

  override fun onCreate(savedInstanceState: Bundle?) {
    super.onCreate(savedInstanceState)
    setContent {
      val state by viewModel.uiState.collectAsStateWithLifecycle()
      MFASignInView(state = state, onSubmit = viewModel::submit, onVerify = viewModel::verify)
    }
  }
}

@Composable
fun MFASignInView(
  state: MFASignInViewModel.UiState,
  onSubmit: (String, String) -> Unit,
  onVerify: (String) -> Unit,
) {
  var email by remember { mutableStateOf("") }
  var password by remember { mutableStateOf("") }
  var code by remember { mutableStateOf("") }

  Column(
    modifier = Modifier.fillMaxSize(),
    verticalArrangement = Arrangement.spacedBy(16.dp, Alignment.CenterVertically),
    horizontalAlignment = Alignment.CenterHorizontally,
  ) {
    when (state) {
      MFASignInViewModel.UiState.NeedsSecondFactor -> {
        TextField(value = code, onValueChange = { code = it }, placeholder = { Text("Code") })
        Button(onClick = { onVerify(code) }) { Text("Submit") }
      }
      MFASignInViewModel.UiState.Unverified -> {
        TextField(value = email, onValueChange = { email = it }, placeholder = { Text("Email") })
        TextField(
          value = password,
          onValueChange = { password = it },
          placeholder = { Text("Password") },
          visualTransformation = PasswordVisualTransformation(),
        )
        Button(onClick = { onSubmit(email, password) }) { Text("Next") }
      }
      MFASignInViewModel.UiState.Verified -> {
        Text("Verified")
      }
    }
  }
}
```
