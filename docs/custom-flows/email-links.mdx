---
title: Build a custom flow for handling email links
description: Learn how to build a custom flow using Clerk's API to handle email links for sign-up, sign-in, and email address verification.
---

> [!WARNING]
> This guide is for users who want to build a _custom_ user interface using the Clerk API. To use a _prebuilt_ UI, you should use Clerk's [Account Portal pages](/docs/customization/account-portal//overview) or [prebuilt components](/docs/components/overview).

[Email links](/docs/authentication/configuration/sign-up-sign-in-options#email-link) can be used to sign up new users, sign in existing ones, or allow existing users to verify newly entered email addresses to their profile.

The email link flow works as follows:

1. The user enters their email address and asks for an email link.
1. Clerk sends an email to the user, containing a link to the verification URL.
1. The user visits the email link. This can happen on the same device where they entered their email address, or on a different device.
1. Clerk will verify the user's identity and advance any sign-up or sign-in attempt that might be in progress.
1. If the verification is successful, the user is authenticated or their email address is verified, depending on the reason for the email link.

This guide will demonstrate how to use Clerk's API to build a custom flow for handling email links. It will cover the following scenarios:

- [Sign up](#sign-up-flow)
- [Sign in](#sign-in-flow)
- [Verify a new email address](#email-address-verification-flow)

{/* TODO: Update these Steps when the Steps component can accept other headings. As of right now, Steps can only accept H3s. */}

<Steps>
  ### Enable email link authentication

  To allow your users to sign up or sign in using email links, you first need configure the appropriate settings in the Clerk Dashboard.

  1. Navigate to the [Clerk Dashboard](https://dashboard.clerk.com/last-active?path=user-authentication/email-phone-username).
  1. In the navigation sidebar, select **User & Authentication > Email, Phone, and Username**.
  1. In the **Contact information** section, **Email address** should be enabled.
  1. In the **Username** section, ensure that **Username** is not required, or else the `create()` method will require a username to be passed in the params. If you would like to use usernames, you must handle collecting the username in your custom flow.
  1. In the **Authentication strategies** section, toggle on **Email verification link**.
  1. Keep this page open as you will need to enable email link verification in the next step.

  ### Enable email link verification

  [**Verification methods**](/docs/authentication/configuration/sign-up-sign-in-options#verification-methods) are different from [**Authentication strategies**](/docs/authentication/configuration/sign-up-sign-in-options#authentication-strategies). **Authentication strategies** are used for authenticating a user, such as when they are signing in to your application. **Verification methods** are used for verifying a user's identifier, such as an email address upon initial sign-up or when updating their profile.

  To allow your users to verify their email addresses using email links, configure the following settings:

  1. On this same page in the Clerk Dashboard, next to **Email address**, select the settings cog icon. A modal will open.
  1. Under **Verification methods**, enable the **Email verification link** option. For the sake of this guide, uncheck the box for **Email verification code**.
  1. Select **Continue** to save your changes.

  ### Create the flows

  The flow for handling email links is the same across all scenarios. You must:

  1. Initiate the sign-up, sign-in, or email verification process by collecting the user's email address.
  1. Prepare the email address verification, which sends an email link to the given address.
  1. Handle the email link verification result accordingly.
     - If the email address verification is successful, set the newly created session as the active session.
     - If the verification failed or the email link has expired, inform the user.

  ### Sign-up flow

  In the following example, the user is prompted to enter their email address and then click a button to sign up using an email link. The user is then redirected to a verification page where they can see the result of the email link verification.

  ### Sign-in flow

  In the following example, the user is prompted to enter their email address and then click a button to sign in using an email link. The user is then redirected to a verification page where they can see the result of the email link verification.

  ### Email address verification flow

  In the following example, the user is prompted to enter their email address and then click a button to verify their email address using an email link. The user is then redirected to a verification page where they can see the result of the email link verification.

  <CodeBlockTabs type="framework" options={["Next.js", "React", "JavaScript"]}>
    ```jsx {{ prettier: false }}
    import React from "react";
    import { useUser, useEmailLink } from "@clerk/nextjs";

    // A page where users can add a new email address.
    function NewEmailPage() {
      const [email, setEmail] = React.useState('');
      const [emailAddress, setEmailAddress] = React.useState(null);
      const [verified, setVerified] = React.useState(false);

      const { user } = useUser();

      async function submit(e) {
        e.preventDefault();
        const res = await user.createEmailAddress({ email });
        setEmailAddress(res);
      }

      if (emailAddress && !verified) {
        return (
          <VerifyWithEmailLink
            emailAddress={emailAddress}
            onVerify={() => setVerified(true)}
          />
        );
      }

      return (
        <form onSubmit={submit}>
          <input
            type="email"
            value={email}
            onChange={e => setEmail(e.target.value)}
          />
        </form>
      );
    }

    // A page which verifies email addresses with email links.
    function VerifyWithEmailLink({
      emailAddress,
      onVerify,
    }) {
      const { startEmailLinkFlow } = useEmailLink(emailAddress);

      React.useEffect(() => {
        verify();
      }, []);

      async function verify() {
        // Start the email link flow.
        // Pass your app URL that users will be navigated
        // when they click the email link from their
        // email inbox.
        const res = await startEmailLinkFlow({
          redirectUrl: "https://redirect-from-email-email-link",
        });

        // res will hold the updated EmailAddress object.
        if (res.verification.status === "verified") {
          onVerify();
        } else {
          // act accordingly
        }
      }

      return (
        <div>
          Waiting for verification...
        </div>
      );
    }
    ```

    ```jsx {{ prettier: false }}
    import React from "react";
    import { useUser, useEmailLink } from "@clerk/clerk-react";

    // A page where users can add a new email address.
    function NewEmailPage() {
      const [email, setEmail] = React.useState('');
      const [emailAddress, setEmailAddress] = React.useState(null);
      const [verified, setVerified] = React.useState(false);

      const { user } = useUser();

      async function submit(e) {
        e.preventDefault();
        const res = await user.createEmailAddress({ email });
        setEmailAddress(res);
      }

      if (emailAddress && !verified) {
        return (
          <VerifyWithEmailLink
            emailAddress={emailAddress}
            onVerify={() => setVerified(true)}
          />
        );
      }

      return (
        <form onSubmit={submit}>
          <input
            type="email"
            value={email}
            onChange={e => setEmail(e.target.value)}
          />
        </form>
      );
    }

    // A page which verifies email addresses with email links.
    function VerifyWithEmailLink({
      emailAddress,
      onVerify,
    }) {
      const { startEmailLinkFlow } = useEmailLink(emailAddress);

      React.useEffect(() => {
        verify();
      }, []);

      async function verify() {
        // Start the email link flow.
        // Pass your app URL that users will be navigated
        // when they click the email link from their
        // email inbox.
        const res = await startEmailLinkFlow({
          redirectUrl: "https://redirect-from-email-email-link",
        });

        // res will hold the updated EmailAddress object.
        if (res.verification.status === "verified") {
          onVerify();
        } else {
          // act accordingly
        }
      }

      return (
        <div>
          Waiting for verification...
        </div>
      );
    }
    ```

    ```js {{ prettier: false }}
    const user = window.Clerk.user;
    const emailAddress = user.emailAddresses[0];
    const {
        startEmailLinkFlow,
        cancelEmailLinkFlow,
    } = emailAddress.createEmailLinkFlow();

    // Pass your app URL that users will be navigated
    // when they click the email link from their
    // email inbox.
    const res = await startEmailLinkFlow({
      redirectUrl: "https://redirect-from-email-email-link",
    });
    if (res.verification.status === "verified") {
      // email address was verified
    } else {
      // email address wasn't verified
    }
    // Cleanup
    cancelEmailLinkFlow();
    ```
  </CodeBlockTabs>
</Steps>
