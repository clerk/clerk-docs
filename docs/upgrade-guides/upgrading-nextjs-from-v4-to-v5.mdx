---
title: Upgrading Next.js from v4 to v5
description: Learn how to upgrade Clerk's Next.js SDK from v4 to v5.
---

# Upgrading Next.js from v4 to v5

By the end of this guide, youâ€™ll have successfully upgraded your Next.js project to use `@clerk/nextjs` v5. Youâ€™ll learn how to update your dependencies, resolve breaking changes, and find deprecations.

Step-by-step instructions will lead you through the process. If youâ€™re looking for a reference list of changes, check out the general [upgrading from v4 to v5 guide](/docs/upgrade-guides/upgrading-from-v4-to-v5).

To aid you in this upgrade, Clerk built a CLI called [`@clerk/upgrade`](https://www.npmjs.com/package/@clerk/upgrade). Throughout this guide you'll see prompts to use the CLI which you can invoke directly in your terminal.

<CodeBlockTabs type="installer" options={["npm", "yarn", "pnpm"]}>
  ```bash filename="terminal"
  npx @clerk/upgrade
  ```

  ```bash filename="terminal"
  yarn dlx @clerk/upgrade
  ```

  ```bash filename="terminal"
  pnpm dlx @clerk/upgrade
  ```
</CodeBlockTabs>

## Minimum version requirements

The minimum version requirements for Node.js, React, and Next.js have been updated. Versions that are no longer supported or are at end-of-life are no longer guaranteed to work correctly with Clerk. Please take a moment to check your dependencies and ensure you are up to date!

**Updating Node.js**

You need to have Node.js `18.17.0` or later installed. Last year, Node.js 16 entered EOL (End of life) status so it's time to bump the required version for `@clerk/nextjs`, too. You can check your Node.js version by running `node -v` in your terminal. Learn more about how to [update and install Node.js](https://nodejs.org/en/learn/getting-started/how-to-install-nodejs).

**Updating React**

`@clerk/nextjs` now requires you to use React 18 or higher. You can update your project by installing the latest version of `react` and `react-dom`.

<CodeBlockTabs type="installer" options={["npm", "yarn", "pnpm"]}>
    ```bash filename="terminal"
    npm install react@latest react-dom@latest
    ```

    ```bash filename="terminal"
    yarn add react@latest react-dom@latest
    ```

    ```bash filename="terminal"
    pnpm add react@latest react-dom@latest
    ```
</CodeBlockTabs>

If you are upgrading from React 17 or lower, make sure to [learn about how to upgrade to React 18](https://react.dev/blog/2022/03/08/react-18-upgrade-guide) as well.

**Updating Next.js**

`@clerk/nextjs` now requires you to use Next.js `13.0.4` or later. Check out Next's upgrade guides for more guidance if you have not yet upgraded to Next.js 13:

- [Upgrading from 12 to 13](https://nextjs.org/docs/pages/building-your-application/upgrading/version-13)
- [Upgrading from 13 to 14](https://nextjs.org/docs/app/building-your-application/upgrading/version-14)

## Redesigned components

The new version ships with improved design and UX across all of Clerk's [UI components](/docs/components/overview). If you have used the [`appearance` prop](/docs/components/customization/overview) or tokens for a [custom theme](/docs/components/customization/overview#create-a-custom-theme), you will likely need to make some adjustments to ensure your styling is still looking great. If you're using the [localization prop](/docs/components/customization/localization) you will likely need to make adjustments to account for added or removed localization keys.

<Callout type="info" >
  If you are not customizing the appearance of your components, or using `localization`, you can skip this section. Otherwise it's recommended to use the CLI (`npx @clerk/upgrade`) to scan for changes required as part of the component redesign.
</Callout>

The sections below contain more info on each change made to the customization IDs and localization keys for reference. Regardless of how thoroughly you have reviewed the following information, you should still take some time to manually look through each of your views to ensure that everything looks allright.

### Appearance changes

<Accordion titles={["<code>Settings</code> -&gt; <code>General</code> tab in <code>OrganizationProfile</code>", "Within <code>&lt;UserProfile /&gt;</code>, Account and Security Pages Separated", "Within <code>&lt;UserProfile /&gt;</code>, Multi-Factor Auth is Added via Dropdown", "Within <code>&lt;UserProfile /&gt;</code>, Connected Accounts Added via Dropdown", "<code>userButtonPopoverActionButtonText</code> customization id removed", "<code>userButtonBox</code> is now a child of <code>userButtonTrigger</code>", "<code>organizationSwitcherPopoverActionButtonText</code> customization id removed", "Changes to the <code>card</code> customization id", "Back button customization ids change on alternative 2fa methods page", "<code>button</code> -&gt; <code>organizationListCreateOrganizationActionButton</code> customization id", "<code>socialButtonsBlockButtonArrow</code> customization id removed", "Identity preview avatar customization ids removed", "Changes to default variables"]}>
<AccordionPanel>
The "Settings" tab within the `<OrganizationProfile />` component has been renamed to "General". If you are linking directly to `/organization-settings` from anywhere, the link will need to be updated to `/organization-general`.

If you are [customizing the component](https://clerk.com/docs/components/customization/organization-profile) by re-ordering the pages, the label used to target this page must be changed from `settings` to `general` as well.

If you are using the [appearance prop](https://clerk.com/docs/components/customization/overview) to customize the appearance of the `<OrganizationProfile />` component, please note that the `cl-profilePage__organizationSettings` key has also been changed to `cl-profilePage__organizationGeneral` to be consistent with the naming change.
</AccordionPanel>
<AccordionPanel>
Within the `<UserProfile />` component (which is also rendered by `<UserButton />`), the "Account" and "Security" pages now live within their own tabs. Previously, "Security" was a section within the "Account" tab. The "Security" page can now be directly linked to under the `/security` path if desired.
</AccordionPanel>
<AccordionPanel>
Within the `<UserProfile />` component (which is also rendered by `<UserButton />`), adding a multi-factor auth (MFA) method is now rendered as a dropdown instead of a modal. If you were relying on the modal for any sort of customizations, these customizations will need to be adjusted to the new form factor.

Two new appearance prop keys were added to aid with this process: `cl-menuList__mfa` for styling the list of MFA factors, and `cl-menuItem__mfa` for styling individual items.
</AccordionPanel>
<AccordionPanel>
Within the `<UserProfile />` component (which is also rendered by `<UserButton />`), adding a connected account is now rendered as a dropdown instead of a modal. If you were relying on the modal for any sort of customizations, these customizations will need to be adjusted to the new form factor.

New appearance prop keys were added to aid with customization, if desired:

- `cl-menuList__connectedAccounts` for styling the list of connected account addition options
- `cl-menuItem__connectedAccounts` for styling individual items in the connected account options list
- `cl-menuList__web3Wallets` for styling the list of web3 wallet addition options
- `cl-menuItem__web3Wallets` for styling individual items in the web3 wallets options list
</AccordionPanel>
<AccordionPanel>
The `userButtonPopoverActionButtonText` customization id has been removed, as the text for this button is now directly rendered inside the button rather than an extra wrapping element. The nested ids `userButtonPopoverActionButtonText__signOut` and `userButtonPopoverActionButtonText__manageAccount` have also been removed. Any styling that needs to apply to the text can be applied to its direct parent `cl-userButtonPopoverActionButton`.
</AccordionPanel>
<AccordionPanel>
The parent-child relationship of the two elements `userButtonTrigger` and `userButtonBox` has been swapped. Previously, `userButtonTrigger` was nested inside of `userButtonBox`, and now `userButtonBox` is nested inside of `userButtonTrigger`. This change resolves [some usability issues](https://github.com/clerk/javascript/issues/1625) in `<UserButton />`. If you are applying style customization to either of these elements, your customizations may need to be adjusted.
</AccordionPanel>
<AccordionPanel>
The `organizationSwitcherPopoverActionButtonText` customization id has been removed, as the text for this button is now directly rendered inside the button rather than an extra wrapping element. The nested ids `organizationSwitcherPopoverActionButtonText__manageOrganization` and `organizationSwitcherPopoverActionButtonText__createOrganization` have also been removed. Any styling that needs to apply to the text can be applied to its direct parent `cl-organizationSwitcherPopoverActionButton`.
</AccordionPanel>
<AccordionPanel>
The `card` customization ID in the previous major version was the main and only container element for components outside the `card` element. A new `cardBox` ID was introduced that allows more fine-grained style customization.

As a note, if you are changing the background color of `card`, you will also need to also apply the same color on the `footer` id as well. The `footer` now gray by default, and itâ€™s located outside `card`, but inside `cardBox`.

A `footerItem` ID was added for more targeted styling of items inside the `footer`.
</AccordionPanel>
<AccordionPanel>
The "back" button on the panel within `<SignIn />` that lists out alternative two factor auth methods has changed location, and there have been some changes to the ids as a result of this:

- `headerBackIcon` has been removed, as there is no longer an associated icon
- `headerBackRow` has been renamed to `backRow` as it's no longer in the header
- `headerBackLink` has been renamed to `backLink` as it's no longer in the header
</AccordionPanel>
<AccordionPanel>
The `button` customization id was used only in one place, for a button to create a new organization in the `<OrganizationList />` component. This id has been removed and replaced by the more appropriately named `organizationListCreateOrganizationActionButton` customization id instead.
</AccordionPanel>
<AccordionPanel>
Social sign-in buttons in the new component designs no longer include arrows, so the `socialButtonsBlockButtonArrow` customization id has been removed. You can use the `socialButtonsIconButton` to apply custom styling to the social buttons if desired.
</AccordionPanel>
<AccordionPanel>
When signing in with Clerk's `<SignIn />` component, after entering a username or email the user is brought to a second pane where they can enter a second factor such as a password. On this pane, there is an area called "identity preview" that shows the username/email that they are entering a password/etc for. Previously, this area included the user's avatar, but this is no longer the case in updated designs. As such, the customization ids related to the user's avatar have been removed.
</AccordionPanel>
<AccordionPanel>
The default values of some [appearance variables](/docs/components/customization/variables) have changed which may impact your UI (if you are not already overriding them).

    - The default `colorPrimary` value changed from `#103FEF` to `#2F3037`. As the new color is a dark grey, the `colorPrimary` of the dark theme was changed to `#FFFFFF`.
    - The default `fontSize` value changed from `1rem` to `0.8125rem`
    - The default `fontWeight` values changed from `{ normal: 400, medium: 500, bold: 600 }` to `{ normal: 400, medium: 500, bold: 700 }`
    - Previously, the default value for `fontSmoothing` was `auto`. This value is now unset. If you want to pass a custom value to it, you can still do so.
</AccordionPanel></Accordion>

### Localization changes

<Accordion titles={["New localization keys added", "Removed localization keys", "Localization keys changed"]}>
<AccordionPanel>
As part of the redesign of Clerk's components, a number of new localization keys have been added and can be seen along with their default english values in the code block below. If you do not supply translated values for these keys in your custom localization, they will fall back to the default english values specified below.

```js
const newValues = {
  formFieldLabel__organizationName: 'Name',
  formFieldLabel__organizationSlug: 'Slug',
  formFieldInputPlaceholder__emailAddresses: 'example@email.com, example2@email.com',
  formFieldInputPlaceholder__organizationSlug: 'my-org',
  signUp: {
    start: {
      subtitle: 'Welcome! Please fill in the details to get started.',
      actionText: 'Already have an account?',
    },
    emailCode: {
      subtitle: 'Enter the verification code sent to your email',
    },
    phoneCode: {
      subtitle: 'Enter the verification code sent to your phone',
    },
    continue: {
      subtitle: 'Please fill in the remaining details to continue.',
      actionText: 'Already have an account?',
    },
  },
  signIn: {
    start: {
      title: 'Sign in to {{applicationName}}',
      subtitle: 'Welcome back! Please sign in to continue',
      actionText: 'Donâ€™t have an account?',
    },
    password: {
      subtitle: 'Enter the password associated with your account',
    },
    forgotPasswordAlternativeMethods: {
      label__alternativeMethods: 'Or, sign in with another method',
    },
    resetPassword: {
      title: 'Set new password',
    },
    phoneCodeMfa: {
      subtitle: 'To continue, please enter the verification code sent to your phone',
    },
    totpMfa: {
      subtitle: 'To continue, please enter the verification code generated by your authenticator app',
    },
    backupCodeMfa: {
      subtitle: 'Your backup code is the one you got when setting up two-step authentication.',
    },
  },
  userProfile: {
    formButtonPrimary__continue: 'Save',
    start: {
      headerTitle__account: 'Profile details',
      profileSection: {
        primaryButton: 'Edit profile',
      },
      emailAddressesSection: {
        detailsAction__unverified: 'Verify',
        destructiveAction: 'Remove email',
      },
      mfaSection: {
        phoneCode: {
          destructiveActionLabel: 'Remove',
        },
        backupCodes: {
          actionLabel__regenerate: 'Regenerate',
        },
      },
      dangerSection: {
        title: 'Account termination',
        deleteAccountButton: 'Delete account',
      },
    },
    profilePage: {
      imageFormSubtitle: 'Upload',
      imageFormDestructiveActionSubtitle: 'Remove',
    },
    phoneNumberPage: {
      title: 'Add a phone number',
      infoText:
        'A text message containing a verification link will be sent to this phone number. Message and data rates may apply.',
    },
    connectedAccountPage: {
      socialButtonsBlockButton: '{{provider|titleize}}',
    },
    mfaPhoneCodePage: {
      subtitle__availablePhoneNumbers:
        'Select an existing phone number to register for SMS code two-step verification or add a new one.',
      subtitle__unavailablePhoneNumbers:
        'There are no available phone numbers to register for SMS code two-step verification, please add a new one.',
    },
    deletePage: {
      actionDescription: 'Type "Delete account" below to continue.',
    },
  },
  organizationSwitcher: {
    action__createOrganization: 'Create organization',
    action__manageOrganization: 'Manage',
  },
  organizationProfile: {
    profilePage: {
      title: 'Update Profile',
      dangerSection: {
        title: 'Danger',
        leaveOrganization: {
          actionDescription: 'Type "{{organizationName}}" below to continue.',
        },
        deleteOrganization: {
          actionDescription: 'Type "{{organizationName}}" below to continue.',
        },
      },
    },
    invitePage: {
      title: 'Invite new members',
      subtitle: 'Enter or paste one or more email addresses, separated by spaces or commas.',
    },
  },
  createOrganization: {
    title: 'Create organization',
  },
  organizationList: {
    title: 'Choose an account',
    titleWithoutPersonal: 'Choose an organization',
  },
};
```
</AccordionPanel>
<AccordionPanel>
As part of the redesign of Clerk's components, a number of localization keys have been removed as they were no longer present in the new designs. You should remove any of these keys that are present in your localization object as they are no longer needed.

```js
const deletedKeys = [
  'signIn.forgotPassword.title_email',
  'signIn.forgotPassword.title_phone',
  'signIn.forgotPassword.formSubtitle_email',
  'signIn.forgotPassword.formSubtitle_phone',
  'signIn.emailCode.formSubtitle',
  'signIn.phoneCode.formSubtitle',
  'signIn.phoneCodeMfa.formSubtitle',
  'signIn.totpMfa.formSubtitle',
  'signIn.backupCodeMfa.formTitle',
  'signIn.backupCodeMfa.formSubtitle',
  'userProfile.start.emailAddressesSection.detailsTitle__primary',
  'userProfile.start.emailAddressesSection.detailsSubtitle__primary',
  'userProfile.start.emailAddressesSection.detailsTitle__nonPrimary',
  'userProfile.start.emailAddressesSection.detailsSubtitle__nonPrimary',
  'userProfile.start.emailAddressesSection.detailsTitle__unverified',
  'userProfile.start.emailAddressesSection.detailsSubtitle__unverified',
  'userProfile.start.emailAddressesSection.destructiveActionTitle',
  'userProfile.start.emailAddressesSection.destructiveActionSubtitle',
  'userProfile.start.phoneNumbersSection.detailsTitle__primary',
  'userProfile.start.phoneNumbersSection.detailsSubtitle__primary',
  'userProfile.start.phoneNumbersSection.detailsTitle__nonPrimary',
  'userProfile.start.phoneNumbersSection.detailsSubtitle__nonPrimary',
  'userProfile.start.phoneNumbersSection.detailsTitle__unverified',
  'userProfile.start.phoneNumbersSection.detailsSubtitle__unverified',
  'userProfile.start.phoneNumbersSection.destructiveActionTitle',
  'userProfile.start.phoneNumbersSection.destructiveActionSubtitle',
  'userProfile.start.connectedAccountsSection.title__conectionFailed',
  'userProfile.start.connectedAccountsSection.title__connectionFailed',
  'userProfile.start.connectedAccountsSection.title__reauthorize',
  'userProfile.start.connectedAccountsSection.subtitle__reauthorize',
  'userProfile.start.connectedAccountsSection.actionLabel__conectionFailed',
  'userProfile.start.connectedAccountsSection.destructiveActionSubtitle',
  'userProfile.start.connectedAccountsSection.destructiveActionAccordionSubtitle',
  'userProfile.start.mfaSection.phoneCode.destructiveActionTitle',
  'userProfile.start.mfaSection.phoneCode.destructiveActionSubtitle',
  'userProfile.start.mfaSection.phoneCode.title__default',
  'userProfile.start.mfaSection.phoneCode.title__setDefault',
  'userProfile.start.mfaSection.phoneCode.subtitle__default',
  'userProfile.start.mfaSection.phoneCode.subtitle__setDefault',
  'userProfile.start.mfaSection.totp.title',
  'userProfile.start.mfaSection.totp.subtitle',
  'userProfile.start.mfaSection.totp.destructiveActionSubtitle',
  'userProfile.start.mfaSection.totp.destructiveActionLabel',
  'userProfile.start.activeDevicesSection.primaryButton',
  'userProfile.start.activeDevicesSection.detailsTitle',
  'userProfile.start.activeDevicesSection.detailsSubtitle',
  'userProfile.start.activeDevicesSection.destructiveActionTitle',
  'userProfile.start.activeDevicesSection.destructiveActionSubtitle',
  'userProfile.start.web3WalletsSection.destructiveActionTitle',
  'userProfile.start.web3WalletsSection.destructiveActionSubtitle',
  'userProfile.start.dangerSection.deleteAccountTitle',
  'userProfile.start.dangerSection.deleteAccountDescription',
  'userProfile.start.headerSubtitle__account',
  'userProfile.start.headerSubtitle__security',
  'organizationProfile.start.headerTitle__settings',
  'organizationProfile.start.headerSubtitle__members',
  'organizationProfile.start.headerSubtitle__settings',
  'organizationProfile.profilePage.domainSection.unverifiedDomain_menuAction__verify',
  'organizationProfile.profilePage.domainSection.unverifiedDomain_menuAction__remove',
  'organizationProfile.profilePage.subtitle',
  'organizationProfile.membersPage.start.headerTitle__active',
  'organizationProfile.membersPage.start.headerTitle__invited',
  'createOrganization.subtitle',
  'formFieldLabel__emailAddress_phoneNumber',
  'formFieldLabel__phoneNumber_username',
  'formFieldLabel__emailAddress_phoneNumber_username',
  'formFieldInputPlaceholder__emailAddress_phoneNumber',
  'formFieldInputPlaceholder__phoneNumber_username',
  'formFieldInputPlaceholder__emailAddress_phoneNumber_username',
  'userProfile.phoneNumberPage.infoText__secondary',
  'userProfile.mfaPhoneCodePage.successMessage',
  'userProfile.profilePage.fileDropAreaTitle',
  'userProfile.profilePage.fileDropAreaAction',
];
```

If you'd like to automate this, you can use the [lodash omit function](https://lodash.com/docs/#omit) as such:

```js
import { omit } from 'lodash-es';

const localization = omit(yourOldOject, deletedKeys);
```
</AccordionPanel>
<AccordionPanel>
The values of some keys have been changed on the default [en-US localization object](https://github.com/clerk/javascript/blob/main/packages/localizations/src/en-US.ts). The list below shows you the new defaults (as of writing this guide) which you can either use or overwrite. If you have overridden these values, make sure to double check so you can be sure that your modifications are appropriate.

```js
const changedValues = {
  formFieldLabel__organizationName: 'Name',
  formFieldLabel__organizationSlug: 'Slug',
  formFieldInputPlaceholder__emailAddresses: 'example@email.com, example2@email.com',
  formFieldInputPlaceholder__organizationSlug: 'my-org',
  signUp: {
    start: {
      subtitle: 'Welcome! Please fill in the details to get started.',
      actionText: 'Already have an account?',
    },
    emailCode: {
      subtitle: 'Enter the verification code sent to your email',
    },
    phoneCode: {
      subtitle: 'Enter the verification code sent to your phone',
    },
    continue: {
      subtitle: 'Please fill in the remaining details to continue.',
      actionText: 'Already have an account?',
    },
  },
  signIn: {
    start: {
      title: 'Sign in to {{applicationName}}',
      subtitle: 'Welcome back! Please sign in to continue',
      actionText: 'Donâ€™t have an account?',
    },
    password: {
      subtitle: 'Enter the password associated with your account',
    },
    forgotPasswordAlternativeMethods: {
      label__alternativeMethods: 'Or, sign in with another method',
    },
    resetPassword: {
      title: 'Set new password',
    },
    phoneCodeMfa: {
      subtitle: 'To continue, please enter the verification code sent to your phone',
    },
    totpMfa: {
      subtitle: 'To continue, please enter the verification code generated by your authenticator app',
    },
    backupCodeMfa: {
      subtitle: 'Your backup code is the one you got when setting up two-step authentication.',
    },
  },
  userProfile: {
    formButtonPrimary__continue: 'Save',
    start: {
      headerTitle__account: 'Profile details',
      profileSection: {
        primaryButton: 'Edit profile',
      },
      emailAddressesSection: {
        detailsAction__unverified: 'Verify',
        destructiveAction: 'Remove email',
      },
      mfaSection: {
        phoneCode: {
          destructiveActionLabel: 'Remove',
        },
        backupCodes: {
          actionLabel__regenerate: 'Regenerate',
        },
      },
      dangerSection: {
        title: 'Account termination',
        deleteAccountButton: 'Delete account',
      },
    },
    profilePage: {
      imageFormSubtitle: 'Upload',
      imageFormDestructiveActionSubtitle: 'Remove',
    },
    phoneNumberPage: {
      title: 'Add a phone number',
      infoText:
        'A text message containing a verification link will be sent to this phone number. Message and data rates may apply.',
    },
    connectedAccountPage: {
      socialButtonsBlockButton: '{{provider|titleize}}',
    },
    mfaPhoneCodePage: {
      subtitle__availablePhoneNumbers:
        'Select an existing phone number to register for SMS code two-step verification or add a new one.',
      subtitle__unavailablePhoneNumbers:
        'There are no available phone numbers to register for SMS code two-step verification, please add a new one.',
    },
    deletePage: {
      actionDescription: 'Type "Delete account" below to continue.',
    },
  },
  organizationSwitcher: {
    action__createOrganization: 'Create organization',
    action__manageOrganization: 'Manage',
  },
  organizationProfile: {
    profilePage: {
      title: 'Update Profile',
      dangerSection: {
        title: 'Danger',
        leaveOrganization: {
          actionDescription: 'Type "{{organizationName}}" below to continue.',
        },
        deleteOrganization: {
          actionDescription: 'Type "{{organizationName}}" below to continue.',
        },
      },
    },
    invitePage: {
      title: 'Invite new members',
      subtitle: 'Enter or paste one or more email addresses, separated by spaces or commas.',
    },
  },
  createOrganization: {
    title: 'Create organization',
  },
  organizationList: {
    title: 'Choose an account',
    titleWithoutPersonal: 'Choose an organization',
  },
};
```
</AccordionPanel></Accordion>

## New Middleware architecture

User and customer feedback about `authMiddleware()` has been clear in that Middleware logic was a often friction point. As such, in v5 you will find a completely new Middleware helper called [`clerkMiddleware()`](/docs/references/nextjs/clerk-middleware) that will hopefully alleviate all of the issues folks had with `authMiddleware()`.

Additionally, there are now new helpers that enable controlling auth on a _per-page and/or per-layout basis_ when using App Router. While you can still configure which routes are protected via Middleware, the page-based protection strategy is what is now recommended, as the co-location of auth protection configuration with the code for the pages themselves results in a superior developer experience that adds clarity as you navigate your codebase.

### Per-route auth config

Sometimes, code speaks louder than words. Let's get right into an example. `auth().protect()` is added to a layout and and all of its children will be gated by auth.

<Tabs type="auth-protect-layout-page" items={["Layout", "Page"]}>
<Tab>
```ts filename="app/src/dashboard/layout.tsx"
import { auth } from '@clerk/nextjs/server'

export default async function DashboardLayout({ children }) {
    auth().protect();
    // ðŸ‘† This one line is all it takes - the layout and all its children
    // will now redirect to your sign in page for un-authenticated users.

    return <>{children}</>
}
```
</Tab>
<Tab>
```ts filename="app/src/dashboard/page.tsx"
import { auth } from '@clerk/nextjs/server'

export default async function DashboardPage() {
    auth().protect();
    // ðŸ‘† This one line is all it takes - the layout and all its children
    // will now redirect to your sign in page for un-authenticated users.

    return <p>This page is now protected!</p>
}
```
</Tab>
</Tabs>

Want to get more specific with permission gating? Add the role you are gating as a parameter:

```ts filename="app/src/admin/layout.tsx"
import { auth } from '@clerk/nextjs/server'

export default async function AdminLayout({ children }) {
    auth().protect({ role: 'org:admin' });

    return <>{children}</>
}
```

Note that in order for this to work, you will still need Middleware to be present, but it only requires the most minimal configuration:

```ts filename="middleware.ts"
import { clerkMiddleware } from '@clerk/nextjs/server'
 
export default clerkMiddleware()
 
export const config = {
  matcher: ["/((?!.*\\..*|_next).*)", "/", "/(api|trpc)(.*)"],
}
```

If you are using the Pages Router, please use the setup explained in the next section.

### Middleware auth config

If you prefer to define your auth logic within the Middleware, you can still do this with the new version of `@clerk/nextjs`. The primary change was to make `clerkMiddleware()` not protect any routes by default, instead requiring the developer to add routes they would like to be protected by auth. This is a substantial contrast to the previous `authMiddleware()`, which protected all routes by default, requiring the developer to add exceptions. The API was substantially simplified and makes it easier to combine `clerkMiddleware()` with other Middleware helpers.

Here's an example that replicates the auth protection scheme above, but entirely inside the Middleware:

```ts filename="middleware.ts"
import {
  clerkMiddleware,
  createRouteMatcher,
} from "@clerk/nextjs/server"

const isDashboardRoute = createRouteMatcher(["/dashboard(.*)"])
const isAdminRoute = createRouteMatcher(["/admin"])

export default clerkMiddleware((auth, req) => {
  // Restrict admin route to users with specific role
  if (isAdminRoute(req)) auth().protect({ role: "org:admin" })

  // Restrict dashboard routes to logged in users
  if (isDashboardRoute(req)) auth().protect()
})

export const config = {
  matcher: ["/((?!.*\\..*|_next).*)", "/", "/(api|trpc)(.*)"],
}
```

A couple things to note here:

- The `createRouteMatcher` helper makes it easy to define route groups that you can leverage inside the Middleware function and check in whichever order you'd like. Note that it can take an array of routes as well.
- With `clerkMiddleware`, you're defining the routes you want **to be protected**, rather than the routes you don't want to be protected.
- You are able to use the same `auth().protect()` helpers that you can use within layouts/pages here in the Middleware.

### Migrating to `clerkMiddleware()`

Clerk strongly recommends migrating to the new `clerkMiddleware()` for an improved DX and access to all present and upcoming features, but also want to note that `authMiddleware()`, while deprecated, will continue to work in v5 and will not be removed until the next major version, so you do not _need_ to make any changes to your Middleware setup this version.

The most basic migration will be updating the import and changing out the default export.

```diff
- import { authMiddleware } from "@clerk/nextjs"
+ import { clerkMiddleware } from '@clerk/nextjs/server'

- export default authMiddleware()
+ export default clerkMiddleware()

  export const config = {
    matcher: ["/((?!.*\\..*|_next).*)", "/", "/(api|trpc)(.*)"],
  }
```

Of course, in most cases you'll have a more complicated setup than this. You can find some examples below for how to migrate a few common use cases. Be sure to review the [`clerkMiddleware()` documentation](/docs/references/nextjs/clerk-middleware) and [route protection guide](/docs/references/nextjs/route-protection) if your specific use case is not mentioned.

<Accordion titles={["Making the index page public", "Protecting a single route path", "Combining with other middlewares (like i18n)"]} heading="h4">
  <AccordionPanel>
    By default, `clerkMiddleware()` treats all pages as public, so you no longer need to explcitly set `/` as public.

    Before:

    ```ts filename="middleware.ts"
    import { authMiddleware } from "@clerk/nextjs"

    export default authMiddleware({
      publicRoutes: ["/"],
    })

    export const config = {
      matcher: ["/((?!.+\\.[\\w]+$|_next).*)", "/", "/(api|trpc)(.*)"],
    }
    ```

    After:

    ```ts filename="middleware.ts"
    import {
      clerkMiddleware,
      createRouteMatcher
    } from "@clerk/nextjs/server"

    export default clerkMiddleware()

    export const config = {
      matcher: ["/((?!.+\\.[\\w]+$|_next).*)", "/", "/(api|trpc)(.*)"],
    }
    ```
  </AccordionPanel>
  <AccordionPanel>
    Having all routes public except everything under `/dashboard`.

    Before:

    ```ts filename="middleware.ts"
    import { authMiddleware } from "@clerk/nextjs"

    export default authMiddleware({
      publicRoutes: (req) => !req.url.includes("/dashboard"),
    })

    export const config = {
      matcher: ["/((?!.+\\.[\\w]+$|_next).*)", "/", "/(api|trpc)(.*)"],
    }
    ```

    After:

    ```ts filename="middleware.ts"
    import {
      clerkMiddleware,
      createRouteMatcher
    } from "@clerk/nextjs/server"

    const isDashboardRoute = createRouteMatcher(["/dashboard(.*)"])

    export default clerkMiddleware((auth, request) => {
      if (isDashboardRoute(request)) {
        auth().protect()
      }
    })

    export const config = {
      matcher: ["/((?!.+\\.[\\w]+$|_next).*)", "/", "/(api|trpc)(.*)"],
    }
    ```
  </AccordionPanel>
  <AccordionPanel>
    You can call other middlewares inside `clerkMiddleware()`, giving you more direct control over what is called where. An example would be [next-intl](https://next-intl-docs.vercel.app/) to add internationalization to your app.

    Before:

    ```ts filename="middleware.ts"
    import { authMiddleware } from "@clerk/nextjs"
    import createMiddleware from "next-intl/middleware"

    const intlMiddleware = createMiddleware({
      locales: ["en", "de"],
      defaultLocale: "en",
    })

    export default authMiddleware({
      beforeAuth: (req) => {
        return intlMiddleware(req);
      },
      publicRoutes: ["((?!^/dashboard/).*)"],
    })

    export const config = {
      matcher: ["/((?!.+\\.[\\w]+$|_next).*)", "/", "/(api|trpc)(.*)"],
    }
    ```

    After:

    ```ts filename="middleware.ts"
    import {
      clerkMiddleware,
      createRouteMatcher
    } from "@clerk/nextjs/server"
    import createMiddleware from "next-intl/middleware"

    const intlMiddleware = createMiddleware({
      locales: ["en", "de"],
      defaultLocale: "en",
    })

    const isDashboardRoute = createRouteMatcher(["/dashboard(.*)"])

    export default clerkMiddleware((auth, request) => {
      if (isDashboardRoute(request)) {
        auth().protect()
      }

      return intlMiddleware(request)
    })

    export const config = {
      matcher: ["/((?!.+\\.[\\w]+$|_next).*)", "/", "/(api|trpc)(.*)"],
    }
    ```
  </AccordionPanel>
</Accordion>


## Changes to top-level exports

As part of this release, Clerk changed some of the top-level exports of `@clerk/nextjs` in order to improve bundle size and tree-shaking efficiency. These changes have resulted in a ~75% reduction in build size for Middleware bundles. However, you will likely need to make some changes to import paths as a result.

<Callout type="info" >
  Use the CLI tool, `npx @clerk/upgrade`, to automatically find occurences of old imports.
</Callout>

<Accordion titles={["@clerk/nextjs/server", "@clerk/nextjs/errors", "@clerk/nextjs/app-beta", "@clerk/nextjs/ssr", "@clerk/nextjs/edge-middleware", "@clerk/nextjs/edge-middlewarefiles", "@clerk/nextjs/api"]} heading="h4">
  <AccordionPanel>
    Previously these exports have been exported both from `@clerk/nextjs` and `@clerk/nextjs/server`. As of v5 they are only exported from the latter.

    ```diff
      import {
        auth,
        currentUser,
        authMiddleware,
        buildClerkProps,
        verifyToken,
        verifyJwt,
        decodeJwt,
        signJwt,
        constants,
        redirect,
        createAuthenticateRequest,
        createIsomorphicRequest,
    - } from "@clerk/nextjs"
    + } from "@clerk/nextjs/server"
    ```
  </AccordionPanel>
  <AccordionPanel>
    Exports related to errors are now under `@clerk/nextjs/errors`.

    ```diff
      import {
        isClerkAPIResponseError,
        isEmailLinkError,
        isKnownError,
        isMetamaskError,
        EmailLinkErrorCode,
    - } from "@clerk/nextjs"
    + } from "@clerk/nextjs/errors"
    ```
  </AccordionPanel>
  <AccordionPanel>
    The `@clerk/nextjs` import will work with both the app and Pages Router.

    ```diff
    - import { } from "@clerk/nextjs/app-beta"
    + import { } from "@clerk/nextjs"
    ```

    Some behavior may have changed between Clerk's beta and the stable release. Please check on your end if behavior stayed the same.
  </AccordionPanel>
  <AccordionPanel>
    The top-level exports support SSR by default now.

    ```diff
    - import { } from "@clerk/nextjs/ssr"
    + import { } from "@clerk/nextjs"
    ```
  </AccordionPanel>
  <AccordionPanel>
    ```diff
    - import { } from "@clerk/nextjs/edge-middleware"
    + import { } from "@clerk/nextjs"
    ```
  </AccordionPanel>
  <AccordionPanel>
    ```diff
    - import { } from "@clerk/nextjs/edge-middlewarefiles"
    + import { } from "@clerk/nextjs"
    ```
  </AccordionPanel>
  <AccordionPanel>
    The `@clerk/nextjs/api` subpath was removed completely. It re-exported helpers from `@clerk/clerk-sdk-node` and its types. If you relied on these, import from `@clerk/clerk-sdk-node` directly instead.

    ```diff
      import type {
        ClerkMiddleware,
        ClerkMiddlewareOptions,
        LooseAuthProp,
        RequireAuthProp,
        StrictAuthProp,
        WithAuthProp
    - } from "@clerk/nextjs/api"
    + } from "@clerk/clerk-sdk-node"

    - import { requireAuth, withAuth } from "@clerk/nextjs/api"
    + import { requireAuth, withAuth } from "@clerk/clerk-sdk-node"
    ```
  </AccordionPanel>
</Accordion>

## After sign up/in/out URL handling

Defining redirect URLs for after sign up, in, and/or out via the Clerk dashboard has been removed in v5. In your Clerk dashboard, under "paths", there is a section called "Component paths", where URLs could be defined that had a deprecation warning. In v5, this functionality has been removed, and specifying redirect paths via the dashboard will no longer work. If you need to pass a redirect URL for after sign in/up/out, there are [a few different ways this can be done](https://clerk.com/docs/account-portal/custom-redirects), from environment variables to Middleware to supplying them directly to the relevant components.

As part of this change, the default URL for each of these props has been set to `/`, so if you are passing `/` explicitly to any one of the above props, that line is no longer necessary and can be removed.

```diff
- <UserButton afterSignOutUrl='/' />
+ <UserButton />
```

## Deprecation removals & housekeeping

As part of this major version, a large number of previously deprecated props, arguments, methods, etc. have been removed. It's highly unlikely that any given app will encounter any of these items, as they have been used internally or very rarely.

<Callout type="info" >
  For this section more than any other one, please use the CLI upgrade tool (`npx @clerk/upgrade`). As there are a lot of changes, each of which are very unlikely to appear in your codebase, it would take a long time to look for them manually.
</Callout>


### Deprecation removals

<Accordion titles={["<code>CLERK_API_KEY</code> replaced by <code>CLERK_SECRET_KEY</code>", "<code>CLERK_FRONTEND_API</code> replaced by <code>CLERK_PUBLISHABLE_KEY</code>", "<code>CLERK_JS_VERSION</code> should be <code>NEXT_PUBLIC_CLERK_JS_VERSION</code>", "<code>apiKey</code> -&gt; <code>secretKey</code> as param to <code>authMiddleware</code>", "<code>frontendApi</code> -&gt; <code>publishableKey</code> as param to <code>authMiddleware</code>", "<code>apiKey</code> -&gt; <code>secretKey</code> as param to <code>createClerkClient</code>", "<code>frontendApi</code> -&gt; <code>publishableKey</code> as param to <code>createClerkClient</code>", "<code>apiKey</code> -&gt; <code>secretKey</code> as param to <code>getAuth</code>", "<code>frontendApi</code> -&gt; <code>publishableKey</code> as prop to <code>ClerkProvider</code>", "<code>@clerk/nextjs/app-beta</code> import removed", "<code>@clerk/nextjs/ssr</code> import removed", "<code>@clerk/nextjs/edge-middleware</code> import removed", "<code>@clerk/nextjs/edge-middlewarefiles</code> import removed", "<code>API_URL</code> constant removed", "<code>API_VERSION</code> constant removed", "<code>CLERK_JS_URL</code> constant removed", "<code>CLERK_JS_VERSION</code> constant removed", "<code>DOMAIN</code> constant removed", "<code>IS_SATELLITE</code> constant removed", "<code>PROXY_URL</code> constant removed", "<code>PUBLISHABLE_KEY</code> constant removed", "<code>SECRET_KEY</code> constant removed", "<code>SIGN_IN_URL</code> constant removed", "<code>SIGN_UP_URL</code> constant removed", "<code>@clerk/nextjs/api</code> import removed", "<code>MultiSessionAppSupport</code> import moved under <code>/internal</code>", "<code>WithSession</code> component removed", "<code>WithClerk</code> component removed", "<code>WithUser</code> component removed", "<code>withClerk</code> function removed", "<code>withSession</code> function removed", "<code>withUser</code> function removed", "<code>NEXT_PUBLIC_CLERK_JS</code> should be <code>NEXT_PUBLIC_CLERK_JS_URL</code>"]}>
<AccordionPanel>
The `CLERK_API_KEY` environment variable was renamed to `CLERK_SECRET_KEY`. You can visit your [Clerk dashboard](https://dashboard.clerk.com/last-active?path=api-keys) to copy/paste the new keys after choosing your framework. Make sure to update this in all environments (e.g. dev, staging, production).
</AccordionPanel>
<AccordionPanel>
The `CLERK_FRONTEND_API` environment variable was renamed to `CLERK_PUBLISHABLE_KEY`. You can visit your [Clerk dashboard](https://dashboard.clerk.com/last-active?path=api-keys) to copy/paste the new keys after choosing your framework. Make sure to update this in all environments (e.g. dev, staging, production). **Note:** The values are different, so this is not just a key replacement. [More information](/docs/deployments/overview#api-keys-and-environment-variables).
</AccordionPanel>
<AccordionPanel>
If you are using `CLERK_JS_VERSION` as an environment variable, it should be changed to `NEXT_PUBLIC_CLERK_JS_VERSION`Â instead.

This change brings our SDK up to date with the latest standards for next.js - that public environment variables should have the `NEXT_PUBLIC_` prefix. This env variable is not private, so it should get the public prefix.
</AccordionPanel>
<AccordionPanel>
The `apiKey` argument passed to `authMiddleware` must be changed to `secretKey`.

```diff
import { authMiddleware } from '@clerk/nextjs';

- authMiddleware({ apiKey: '...' });
+ authMiddleware({ secretKey: '...' });
```
</AccordionPanel>
<AccordionPanel>
The `frontendApi` argument passed to `authMiddleware` must be changed to `publishableKey`

```diff
import { authMiddleware } from "@clerk/nextjs/server"

- authMiddleware({ frontendApi: '...' })
+ authMiddleware({ publishableKey: '...' })
```
</AccordionPanel>
<AccordionPanel>
The `apiKey` argument passed to `createClerkClient` must be changed to `secretKey`.

```diff
import { createClerkClient } from '@clerk/nextjs/server';

- createClerkClient({ apiKey: '...' });
+ createClerkClient({ secretKey: '...' });
```
</AccordionPanel>
<AccordionPanel>
The `frontendApi` argument passed to `createClerkClient` must be changed to `publishableKey`. Note that the values of the two keys are different, so both keys and values need to be changed. You can find your application's publishable key in the Clerk dashboard.

```diff
import { createClerkClient } from '@clerk/nextjs/server';

- createClerkClient({ frontendApi: '...' });
+ createClerkClient({ publishableKey: '...' });
```
</AccordionPanel>
<AccordionPanel>
The `apiKey` argument passed to `getAuth` must be changed to `secretKey`.

```diff
- getAuth({ apiKey: '...' })
+ getAuth({ secretKey: '...' })
```
</AccordionPanel>
<AccordionPanel>
The `frontendApi` prop passed to `<ClerkProvider>` was renamed to `publishableKey`. **Note:** The values are different, so this is not just a key replacement. You can visit your [Clerk dashboard](https://dashboard.clerk.com/last-active?path=api-keys) to copy/paste the new keys after choosing your framework. Make sure to update this in all environments (e.g. dev, staging, production). [More information](/docs/deployments/overview#api-keys-and-environment-variables).
</AccordionPanel>
<AccordionPanel>
If you are using the `@clerk/nextjs/app-beta` import anywhere, it should useÂ `@clerk/nextjs`Â instead. The `app-beta` import has been removed as our approuter support is stable, if there are any places youâ€™re using it you can remove.

Make this change carefully as some behavior may have changed between our beta and stable releases. You can refer to [our documentation](https://clerk.com/docs/quickstarts/nextjs) and/or [approuter example](https://github.com/clerk/clerk-nextjs-app-quickstart) for up-to-date usage.

The `@clerk/nextjs` import will work with both App Router and Pages Router.
</AccordionPanel>
<AccordionPanel>
If you are importing from `@clerk/nextjs/ssr`, you can useÂ `@clerk/nextjs`Â instead. Our top-level import supports SSR functionality by default now, so the subpath on the import is no longer needed. This import can be directly replaced without any other considerations.
</AccordionPanel>
<AccordionPanel>
This deprecated import has been replaced by `@clerk/nextjs`. Usage should now look as such: `import { authMiddleware } from @clerk/nextjs`. There may be changes in functionality between the two exports depending on how old the version used is, so upgrade with caution.
</AccordionPanel>
<AccordionPanel>
This deprecated import has been replaced by `@clerk/nextjs`. Usage should now look as such: `import { authMiddleware } from @clerk/nextjs`. There may be changes in functionality between the two exports depending on how old the version used is, so upgrade with caution.
</AccordionPanel>
<AccordionPanel>
This deprecated constant has been removed as an export from `@clerk/nextjs`. Define a `CLERK_API_URL` environment variable and use it as a substitute.
</AccordionPanel>
<AccordionPanel>
This deprecated constant has been removed as an export from `@clerk/nextjs`. Define a `CLERK_API_VERSION` environment variable and use it as a substitute.
</AccordionPanel>
<AccordionPanel>
This deprecated constant has been removed as an export from `@clerk/nextjs`. Define a `NEXT_PUBLIC_CLERK_JS` environment variable and use it as a substitute.
</AccordionPanel>
<AccordionPanel>
This deprecated constant has been removed as an export from `@clerk/nextjs`. Define a `NEXT_PUBLIC_CLERK_JS_VERSION` environment variable and use it as a substitute.
</AccordionPanel>
<AccordionPanel>
This deprecated constant has been removed as an export from `@clerk/nextjs`. Define a `NEXT_PUBLIC_CLERK_DOMAIN` environment variable and use it as a substitute.
</AccordionPanel>
<AccordionPanel>
This deprecated constant has been removed as an export from `@clerk/nextjs`. Define a `NEXT_PUBLIC_CLERK_IS_SATELLITE` environment variable and use it as a substitute.
</AccordionPanel>
<AccordionPanel>
This deprecated constant has been removed as an export from `@clerk/nextjs`. Define a `NEXT_PUBLIC_CLERK_PROXY_URL` environment variable and use it as a substitute.
</AccordionPanel>
<AccordionPanel>
This deprecated constant has been removed as an export from `@clerk/nextjs`. Define a `NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY` environment variable and use it as a substitute.
</AccordionPanel>
<AccordionPanel>
This deprecated constant has been removed as an export from `@clerk/nextjs`. Define a `CLERK_SECRET_KEY` environment variable and use it as a substitute.
</AccordionPanel>
<AccordionPanel>
This deprecated constant has been removed as an export from `@clerk/nextjs`. Define a `NEXT_PUBLIC_CLERK_SIGN_IN_URL` environment variable and use it as a substitute.
</AccordionPanel>
<AccordionPanel>
This deprecated constant has been removed as an export from `@clerk/nextjs`. Define a `NEXT_PUBLIC_CLERK_SIGN_UP_URL` environment variable and use it as a substitute.
</AccordionPanel>
<AccordionPanel>
The import subpath `@clerk/nextjs/api` has been removed. This includes the following imports:

```js
// These have been removed
import {
  ClerkMiddleware,
  ClerkMiddlewareOptions,
  LooseAuthProp,
  RequireAuthProp,
  StrictAuthProp,
  WithAuthProp,
} from '@clerk/nextjs/api';
```

If you still need to use any of these functions, they can be instead imported from `@clerk/clerk-sdk-node`.
</AccordionPanel>
<AccordionPanel>
The `MultiSessionAppSupport` import path has changed from `@clerk/nextjs` to `@clerk/nextjs/internal`. You must update your import path in order for it to work correctly. Note that internal imports are not intended for usage and are outside the scope of semver. Example below of the fix that needs to be made:

```diff
- import { MultiSessionAppSupport } from "@clerk/nextjs"
+ import { MultiSessionAppSupport } from "@clerk/nextjs/internal"
```
</AccordionPanel>
<AccordionPanel>
The `WithSession` higher order component has been removed. If you would still like to use this function in the way its implemented, it can be created quickly using Clerk's [custom hooks](https://clerk.com/docs/references/react/overview). An example of how to do so is below:

```js
export const WithSession = ({ children }) => {
  const session = useSession();
  if (typeof children !== 'function') throw new Error();

  return {children(session)};
};
```
</AccordionPanel>
<AccordionPanel>
The `WithClerk` higher order component has been removed. If you would still like to use this function in the way its implemented, it can be created quickly using Clerk's [custom hooks](https://clerk.com/docs/references/react/overview). An example of how to do so is below:

```js
export const WithClerk = ({ children }) => {
  const clerk = useClerk();
  if (typeof children !== 'function') throw new Error();

  return {children(clerk)};
};
```
</AccordionPanel>
<AccordionPanel>
The `WithUser` higher order component has been removed. If you would still like to use this function in the way its implemented, it can be created quickly using Clerk's [custom hooks](https://clerk.com/docs/references/react/overview). An example of how to do so is below:

```js
export const WithUser = ({ children }) => {
  const user = useUser();
  if (typeof children !== 'function') throw new Error();

  return {children(user)};
};
```
</AccordionPanel>
<AccordionPanel>
The `withClerk` higher order function has been removed. If you would still like to use this function in the way its implemented, it can be created quickly using Clerk's [custom hooks](https://clerk.com/docs/references/react/overview). An example of how to do so is below:

```js
function withClerk(Component, displayName) {
  displayName = displayName || Component.displayName || Component.name || 'Component';
  Component.displayName = displayName;
  const HOC = props => {
    const clerk = useIsomorphicClerkContext();

    if (!clerk.loaded) return null;

    return (
      <Component
        {...props}
        clerk={clerk}
      />
    );
  };

  HOC.displayName = `withClerk(${displayName})`;
  return HOC;
}
```
</AccordionPanel>
<AccordionPanel>
The `withSession` higher order function has been removed. If you would still like to use this function in the way its implemented, it can be created quickly using Clerk's [custom hooks](https://clerk.com/docs/references/react/overview). An example of how to do so is below:

```js
function withSession(Component, displayName) {
  displayName = displayName || Component.displayName || Component.name || 'Component';
  Component.displayName = displayName;
  const HOC = props => {
    const session = useSessionContext();

    if (!session) return null;

    return (
      <Component
        {...props}
        session={session}
      />
    );
  };

  HOC.displayName = `withSession(${displayName})`;
  return HOC;
}
```
</AccordionPanel>
<AccordionPanel>
The `withUser` higher order function has been removed. If you would still like to use this function in the way its implemented, it can be created quickly using Clerk's [custom hooks](https://clerk.com/docs/references/react/overview). An example of how to do so is below:

```js
function withUser(Component, displayName) {
  displayName = displayName || Component.displayName || Component.name || 'Component';
  Component.displayName = displayName;
  const HOC = props => {
    const clerk = useUserContext();

    if (!user) return null;

    return (
      <Component
        {...props}
        user={user}
      />
    );
  };

  HOC.displayName = `withUser(${displayName})`;
  return HOC;
}
```
</AccordionPanel>
<AccordionPanel>
If you are using `NEXT_PUBLIC_CLERK_JS` as an environment variable, it should be changed to `NEXT_PUBLIC_CLERK_JS_URL`Â instead. This variable was renamed for consistency across public APIs. Make sure to also check your production host configuration when changing environment variable values.
</AccordionPanel></Accordion>

### Other breaking changes

<Accordion titles={["<code>API_URL</code> value has changed", "<code>isMagicLinkError</code> -&gt; <code>isEmailLinkError</code>", "<code>useMagicLink</code> -&gt; <code>useEmailLink</code>", "<code>MagicLinkErrorCode</code> -&gt; <code>EmailLinkErrorCode</code>", "<code>setSession</code> -&gt; <code>setActive</code>", "Replace <code>signOutCallback</code> prop on <code>SignOutButton</code> with <code>redirectUrl</code>", "<code>Organization.getOrganizationList()</code> return type changed", "<code>Organization.getOrganizationInvitationList()</code> return type changed", "<code>User.getOrganizationMembershipList()</code> return type changed", "<code>Organization.getRoles</code> arguments changed", "<code>Organization.getMemberships</code> arguments changed", "<code>Organization.getDomains</code> arguments changed", "<code>Organization.getInvitations</code> arguments changed", "<code>Organization.getMembershipRequests</code> arguments changed", "<code>User.getOrganizationInvitations</code> arguments changed", "<code>User.getOrganizationSuggestions</code> arguments changed", "<code>User.getOrganizationMemberships</code> arguments changed"]}>
<AccordionPanel>
The value of this export has changed from `https://api.clerk.dev` to `https://api.clerk.com`. If you were relying on the text content of this value not changing, you may need to make adjustments.
</AccordionPanel>
<AccordionPanel>
Across Clerk's documentation and codebases the term "magic link" was changed to "email link" as it more accurately reflects the functionality.
</AccordionPanel>
<AccordionPanel>
Across Clerk's documentation and codebases the term "magic link" was changed to "email link" as it more accurately reflects functionality.
</AccordionPanel>
<AccordionPanel>
Across Clerk's documentation and codebases the term "magic link" was changed to "email link" as it more accurately reflects the functionality.
</AccordionPanel>
<AccordionPanel>
`setSession` should be replaced with `setActive`. The format of the parameters has changed slightly - `setActive` takes an object where `setSession` took params directly. The `setActive` function also can accept an `organization` param that is used to set the currently active organization. The return signature did not change. Read the [API documentation](/docs/references/javascript/clerk/session-methods#set-active) for more detail. This function should be expected to be returned from one of the following Clerk hooks: `useSessionList`, `useSignUp`, or `useSignIn`. Some migration examples:

```diff
- await setSession('sessionID', () => void)
+ await setActive({ session: 'sessionID',  beforeEmit: () => void })

- await setSession(sessionObj)
+ await setActive({ session: sessionObj })

- await setSession(sessionObj, () => void)
+ await setActive({ session: sessionObj,  beforeEmit: () => void })
```

`setActive` also supports setting an active organization:

```js
await setActive({
  session: 'sessionID',
  organization: 'orgID',
  beforeEmit: () => void
})

await setActive({
  session: sessionObj,
  organization: orgObj,
  beforeEmit: () => void
})
```
</AccordionPanel>
<AccordionPanel>
The `signOutCallback` prop on the [`<SignOutButton />` component](https://clerk.com/docs/components/unstyled/sign-out-button) has been removed. Instead, you can use the `redirectUrl` prop. Example below:

```diff
  import { SignOutButton } from "@clerk/clerk-react";

  export const Signout = () => {
    return (
      <SignOutButton
-       signOutCallback={() => { window.location.href = "/your-path" }}
+       redirectUrl="/your-path"
      >
        <button>Sign Out</button>
      </SignOutButton>
    )
  }
```
</AccordionPanel>
<AccordionPanel>
The return type for this function was previously `[Items]` but has now been updated to `{ data: [Items], totalCount: number }`. Since Clerk's API responses are paginated, the `totalCount` property is helpful in determining the total number of items in the response easily. A before/after code example can be seen below:

```diff
  const { organization } = useOrganization()
  const orgList = organization.getOrganizationList()

- orgList.forEach(() => {})
+ orgList.data.forEach(() => {})
```
</AccordionPanel>
<AccordionPanel>
The return type for this function was previously `[Items]` but has now been updated to `{ data: [Items], totalCount: number }`. Since Clerk's API responses are paginated, the `totalCount` property is helpful in determining the total number of items in the response easily. A before/after code example can be seen below:

```diff
  const { organization } = useOrganization()
  const inviteList = organization.getOrganizationInvitationList()

- inviteList.forEach(() => {})
+ inviteList.data.forEach(() => {})
```
</AccordionPanel>
<AccordionPanel>
The return type for this function was previously `[Items]` but has now been updated to `{ data: [Items], totalCount: number }`. Since Clerk's API responses are paginated, the `totalCount` property is helpful in determining the total number of items in the response easily. A before/after code example can be seen below:

```diff
  const { user } = useUser()
  const membershipList = user.getOrganizationMembershipList()

- membershipList.forEach(() => {})
+ membershipList.data.forEach(() => {})
```
</AccordionPanel>
<AccordionPanel>
There have been a couple changes to the pagination arguments that can be passed into this function - `limit` has been renamed to `pageSize`, and `offset` has been renamed to `initialPage`. This will help to make it more clear and simple to reason about pagination control. Example of how changes might look below:

```diff
  const { data } = await organization.getRoles({
-   limit: 10,
+   pageSize: 10,
-   offset: 10,
+   initialPage: 2,
  })
```
</AccordionPanel>
<AccordionPanel>
There have been a couple changes to the pagination arguments that can be passed into this function - `limit` has been renamed to `pageSize`, and `offset` has been renamed to `initialPage`. This will help to make it more clear and simple to reason about pagination control. Example of how changes might look below:

```diff
  const { data } = await organization.getMemberships({
-   limit: 10,
+   pageSize: 10,
-   offset: 10,
+   initialPage: 2,
  })
```
</AccordionPanel>
<AccordionPanel>
There have been a couple changes to the pagination arguments that can be passed into this function - `limit` has been renamed to `pageSize`, and `offset` has been renamed to `initialPage`. This will help to make it more clear and simple to reason about pagination control. Example of how changes might look below:

```diff
  const { data } = await organization.getDomains({
-   limit: 10,
+   pageSize: 10,
-   offset: 10,
+   initialPage: 2,
  })
```
</AccordionPanel>
<AccordionPanel>
There have been a couple changes to the pagination arguments that can be passed into this function - `limit` has been renamed to `pageSize`, and `offset` has been renamed to `initialPage`. This will help to make it more clear and simple to reason about pagination control. Example of how changes might look below:

```diff
  const { data } = await organization.getInvitations({
-   limit: 10,
+   pageSize: 10,
-   offset: 10,
+   initialPage: 2,
  })
```
</AccordionPanel>
<AccordionPanel>
There have been a couple changes to the pagination arguments that can be passed into this function - `limit` has been renamed to `pageSize`, and `offset` has been renamed to `initialPage`. This will help to make it more clear and simple to reason about pagination control. Example of how changes might look below:

```diff
  const { data } = await organization.getMembershipRequests({
-   limit: 10,
+   pageSize: 10,
-   offset: 10,
+   initialPage: 2,
  })
```
</AccordionPanel>
<AccordionPanel>
There have been a couple changes to the pagination arguments that can be passed into this function - `limit` has been renamed to `pageSize`, and `offset` has been renamed to `initialPage`. This will help to make it more clear and simple to reason about pagination control. Example of how changes might look below:

```diff
  const { data } = await user.getOrganizationInvitations({
-   limit: 10,
+   pageSize: 10,
-   offset: 10,
+   initialPage: 2,
  })
```
</AccordionPanel>
<AccordionPanel>
There have been a couple changes to the pagination arguments that can be passed into this function - `limit` has been renamed to `pageSize`, and `offset` has been renamed to `initialPage`. This will help to make it more clear and simple to reason about pagination control. Example of how changes might look below:

```diff
  const { data } = await user.getOrganizationSuggestions({
-   limit: 10,
+   pageSize: 10,
-   offset: 10,
+   initialPage: 2,
  })
```
</AccordionPanel>
<AccordionPanel>
There have been a couple changes to the pagination arguments that can be passed into this function - `limit` has been renamed to `pageSize`, and `offset` has been renamed to `initialPage`. This will help to make it more clear and simple to reason about pagination control. Example of how changes might look below:

```diff
  const { data } = await user.getOrganizationMemberships({
-   limit: 10,
+   pageSize: 10,
-   offset: 10,
+   initialPage: 2,
  })
```
</AccordionPanel></Accordion>


