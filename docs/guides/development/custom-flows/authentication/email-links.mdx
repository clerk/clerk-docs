---
title: Build a custom flow for handling email links
description: Learn how to build a custom flow using Clerk's API to handle email links for sign-up, sign-in, and email address verification.
---

<If sdk="expo">
  > [!WARNING]
  > Expo does not support email links. You can request this feature on [Clerk's roadmap](https://feedback.clerk.com/).
</If>

<If notSdk="expo">
  <Include src="_partials/custom-flows-callout" />

  <If sdk={["nextjs", "react", "js-frontend", "react-router", "tanstack-react-start"]}>
    > [!IMPORTANT]
    > This guide applies to the following Clerk SDKs:
    >
    > - `@clerk/react` v6 or higher
    > - `@clerk/nextjs` v7 or higher
    > - `@clerk/react-router` v3 or higher
    > - `@clerk/tanstack-react-start` v0.26.0 or higher
    >
    > If you're using an older version of one of these SDKs, or are using the legacy API, refer to the [legacy API documentation](/docs/guides/development/custom-flows/authentication/legacy/email-links).
  </If>

  [Email links](/docs/guides/configure/auth-strategies/sign-up-sign-in-options) can be used to sign up new users, sign in existing users, or allow existing users to verify newly added email addresses to their user profiles.

  The email link flow works as follows:

  1. The user enters their email address and asks for an email link.
  1. Clerk sends an email to the user, containing a link to the verification URL.
  1. The user visits the email link, either on the same device where they entered their email address or on a different device, [depending on the application's settings in the Clerk Dashboard](!require-same-device-browser).
  1. Clerk verifies the user's identity and advances any sign-up or sign-in attempt that might be in progress.
  1. If the verification is successful, the user is authenticated or their email address is verified, depending on the reason for the email link.

  This guide demonstrates how to use Clerk's API to build a custom flow for handling email links. It covers the following scenarios:

  - [Sign up](#sign-up-flow)
  - [Sign in](#sign-in-flow)
  - [Verify a new email address](#add-new-email-flow)

  <Steps>
    ## Enable email link authentication

    To allow your users to sign up or sign in using email links, you must first configure the appropriate settings in the Clerk Dashboard. **For the examples in this guide to work, you must enable the following settings.** If your application requires more settings to be enabled, you'll need to combine this custom flow with the other appropriate custom flows.

    1. In the Clerk Dashboard, navigate to the [**User & authentication**](https://dashboard.clerk.com/~/user-authentication/user-and-authentication) page.
    1. Enable **Sign-up with email**. Enable **Verify at sign-up** and enable **Email verification link**.
    1. Enable **Sign-in with email**. Enable **Email verification link**. By default, [**Require the same device and browser**](!require-same-device-browser) setting is enabled. This guide includes the code necessary to handle this setting, but you can remove it if you don't want to enforce this setting; there will be a comment in the code to indicate where to remove the code.

    ## Sign-up flow

    1. When the form is submitted, initiate the sign-up process by collecting the user's email address with the [`signUp.create()`](/docs/reference/javascript/sign-up-future#create) method. This creates a new sign-up attempt.
    1. Call the [`signUp.verifications.sendEmailLink()`](/docs/reference/javascript/sign-up-future#verifications-send-email-link) method to send a link to the provided email address so the user can verify their email address. This method requires specifying a `verificationUrl`, which is the destination that the link will redirect the user to.
    1. Call [`signUp.verifications.waitForEmailLinkVerification()`](/docs/reference/javascript/sign-up-future#verifications-wait-for-email-link-verification) to await the result of the verification.
    1. On your verification page (the URL you set as the `verificationUrl` parameter), use the `signUp.verifications.emailLinkVerification` object to access the result of the verification. Use the `status` property to check the result of the verification and handle it accordingly.

    **This example is written for Next.js App Router but it can be adapted for any React-based framework, such as React Router or Tanstack React Start.**

    <CodeBlockTabs options={["Sign up page", "Verify page"]}>
      ```tsx {{ filename: 'app/sign-up/page.tsx', collapsible: true }}
      'use client'

      import * as React from 'react'
      import { useSignUp } from '@clerk/nextjs'

      export default function SignUpPage() {
        const { signUp, errors } = useSignUp()

        const [emailAddress, setEmailAddress] = React.useState('')
        const [verified, setVerified] = React.useState(false)
        const [verifying, setVerifying] = React.useState(false)

        async function handleSubmit(e: React.FormEvent) {
          e.preventDefault()
          // Reset states in case user resubmits form mid sign-up
          setVerified(false)

          setVerifying(true)

          // Start the sign-up process by creating the sign-up attempt
          const { error: createError } = await signUp.create({ emailAddress })
          if (createError) {
            console.error(JSON.stringify(createError, null, 2))
            setVerifying(false)
            return
          }

          // Dynamically set the host domain for dev and prod
          // You could instead use an environment variable or other source for the host domain
          const protocol = window.location.protocol
          const host = window.location.host

          // Send the user an email with the email link
          const { error: sendLinkError } = await signUp.verifications.sendEmailLink({
            // URL to navigate to after the user visits the link in their email
            verificationUrl: `${protocol}//${host}/sign-up/verify`,
          })
          if (sendLinkError) {
            console.error(JSON.stringify(sendLinkError, null, 2))
            setVerifying(false)
            return
          }

          // If email link sent successfully, wait for the user to visit the link in their email
          const { error: waitForVerificationError } =
            await signUp.verifications.waitForEmailLinkVerification()
          if (waitForVerificationError) {
            console.error(JSON.stringify(waitForVerificationError, null, 2))
            setVerifying(false)
            return
          }

          // Check the verification result
          const verification = signUp.verifications.emailAddress

          // Handle if user visited the link and completed sign-up from /sign-up/verify
          if (verification.verifiedFromTheSameClient()) {
            setVerifying(false)
            setVerified(true)
          }
        }

        async function reset(e: React.FormEvent) {
          e.preventDefault()
          setVerifying(false)
        }

        if (verifying) {
          return (
            <div>
              <p>Check your email and visit the link that was sent to you.</p>
              <form onSubmit={reset}>
                <button type="submit">Restart</button>
              </form>
              {/* For your debugging purposes. You can just console.log errors, but we put them in the UI for convenience */}
              {errors && <p>{JSON.stringify(errors, null, 2)}</p>}
            </div>
          )
        }

        if (verified) {
          return <div>Signed up successfully!</div>
        }

        return (
          <div>
            <h1>Sign up</h1>
            <form onSubmit={handleSubmit}>
              <label htmlFor="emailAddress">Enter email address</label>
              <input
                id="emailAddress"
                name="emailAddress"
                type="email"
                value={emailAddress}
                onChange={(e) => setEmailAddress(e.target.value)}
              />
              {errors.fields.emailAddress && <p>{errors.fields.emailAddress.message}</p>}
              <button type="submit">Continue</button>
            </form>
            {/* For your debugging purposes. You can just console.log errors, but we put them in the UI for convenience */}
            {errors && <p>{JSON.stringify(errors, null, 2)}</p>}

            {/* Required for sign-up flows. Clerk's bot sign-up protection is enabled by default */}
            <div id="clerk-captcha" />
          </div>
        )
      }
      ```

      ```tsx {{ filename: 'app/sign-up/verify/page.tsx', collapsible: true }}
      'use client'

      import * as React from 'react'
      import { useSignUp } from '@clerk/nextjs'
      import Link from 'next/link'
      import { useRouter } from 'next/navigation'

      export default function VerifyEmailLink() {
        const { signUp } = useSignUp()
        const router = useRouter()

        const verification = signUp.verifications.emailLinkVerification

        console.log(verification)

        React.useEffect(() => {
          if (verification?.status !== 'verified') {
            return
          }

          // If email link verification status is 'verified', check the `signUp.status`
          void (async () => {
            // If sign-up is complete, finalize the sign-up process
            if (signUp.status === 'complete') {
              const { error } = await signUp.finalize({
                navigate: ({ decorateUrl }) => {
                  const url = decorateUrl('/')
                  if (url.startsWith('http')) {
                    window.location.href = url
                  } else {
                    router.push(url)
                  }
                },
              })
              // If `finalize` fails, check the error
              if (error) {
                console.error(JSON.stringify(error, null, 2))
              }
            } else {
              // If sign-up is not complete, redirect to the sign-up page
              router.push('/sign-up')
            }
          })()
        }, [router, signUp, signUp.status, verification?.status])

        if (!verification) {
          return <div>Loading...</div>
        }

        if (verification.status === 'failed') {
          return (
            <div>
              <h1>Verify your email</h1>
              <p>The email link verification failed.</p>
              <Link href="/sign-up">Sign up</Link>
            </div>
          )
        }

        if (verification.status === 'expired') {
          return (
            <div>
              <h1>Verify your email</h1>
              <p>The email link has expired.</p>
              <Link href="/sign-up">Sign up</Link>
            </div>
          )
        }

        // OPTIONAL: This check is only required if you have
        // the 'Require the same device and browser' setting
        // enabled in the Clerk Dashboard
        if (verification.status === 'client_mismatch') {
          return (
            <div>
              <h1>Verify your email</h1>
              <p>
                You must complete the email link sign-up on the same device and browser that you started
                it on.
              </p>
              <Link href="/sign-up">Sign up</Link>
            </div>
          )
        }

        return (
          <div>
            <h1>Verify your email</h1>
            <p>Successfully signed up. Return to the original tab to continue.</p>
          </div>
        )
      }
      ```
    </CodeBlockTabs>

    ## Sign-in flow

    1. When the form is submitted, initiate the sign-in process by calling the [`signIn.emailLink.sendLink()`](/docs/reference/javascript/sign-in-future#email-link-send-link) method to send a link to the provided email address so the user can use it to sign in. This method requires specifying a `verificationUrl`, which is the destination that the link will redirect the user to.
    1. Call [`signIn.emailLink.waitForVerification()`](/docs/reference/javascript/sign-in-future#email-link-wait-for-verification) to await the result of the verification.
    1. On your verification page (the URL you set as the `verificationUrl` parameter), use the `signIn.emailLink.verification` object to access the result of the verification. Use the `status` property to check the result of the verification and handle it accordingly.

    **This example is written for Next.js App Router but it can be adapted for any React-based framework, such as React Router or Tanstack React Start.**

    <CodeBlockTabs options={["Sign in page", "Verify page"]}>
      ```tsx {{ filename: 'app/sign-in/page.tsx', collapsible: true }}
      'use client'

      import * as React from 'react'
      import { useSignIn } from '@clerk/nextjs'

      export default function SignInPage() {
        const { signIn, errors } = useSignIn()

        const [emailAddress, setEmailAddress] = React.useState('')
        const [verified, setVerified] = React.useState(false)
        const [verifying, setVerifying] = React.useState(false)

        async function handleSubmit(e: React.FormEvent) {
          e.preventDefault()
          // Reset states in case user resubmits form mid sign-in
          setVerified(false)

          // Dynamically set the host domain for dev and prod
          // You could instead use an environment variable or other source for the host domain
          const protocol = window.location.protocol
          const host = window.location.host

          // Start the sign-in process by sending the user an email with the email link
          const { error } = await signIn.emailLink.sendLink({
            emailAddress,
            // URL to navigate to after the user visits the link in their email
            verificationUrl: `${protocol}//${host}/sign-in/verify`,
          })
          if (error) {
            console.error(JSON.stringify(error, null, 2))
            return
          }

          setVerifying(true)

          // If email link sent successfully, wait for the user to visit the link in their email
          const { error: waitForVerificationError } = await signIn.emailLink.waitForVerification()
          if (waitForVerificationError) {
            console.error(JSON.stringify(waitForVerificationError, null, 2))
            setVerifying(false)
            return
          }

          // Check the verification result
          const verification = signIn.firstFactorVerification

          // Handle if verification expired
          if (verification.status === 'expired') {
            console.error('Verification expired')
          }

          // Handle if user visited the link and completed sign-in from /sign-in/verify
          if (verification.verifiedFromTheSameClient()) {
            setVerifying(false)
            setVerified(true)
          }
        }

        async function reset(e: React.FormEvent) {
          e.preventDefault()
          setVerifying(false)
        }

        const verification = signIn.firstFactorVerification

        if (verification.status === 'expired') {
          return (
            <div>
              <p>The email link has expired.</p>
              <form onSubmit={reset}>
                <button type="submit">Restart</button>
              </form>
              {/* For your debugging purposes. You can just console.log errors, but we put them in the UI for convenience */}
              {errors && <p>{JSON.stringify(errors, null, 2)}</p>}
            </div>
          )
        }

        if (verifying) {
          return (
            <div>
              <p>Check your email and visit the link that was sent to you.</p>
              <form onSubmit={reset}>
                <button type="submit">Restart</button>
              </form>
              {/* For your debugging purposes. You can just console.log errors, but we put them in the UI for convenience */}
              {errors && <p>{JSON.stringify(errors, null, 2)}</p>}
            </div>
          )
        }

        if (verified) {
          return <div>Signed in successfully!</div>
        }

        return (
          <div>
            <h1>Sign in</h1>
            <form onSubmit={handleSubmit}>
              <label htmlFor="emailAddress">Enter email address</label>
              <input
                id="emailAddress"
                name="emailAddress"
                type="email"
                value={emailAddress}
                onChange={(e) => setEmailAddress(e.target.value)}
              />
              {errors.fields.identifier && <p>{errors.fields.identifier.message}</p>}
              <button type="submit">Continue</button>
            </form>
            {/* For your debugging purposes. You can just console.log errors, but we put them in the UI for convenience */}
            {errors && <p>{JSON.stringify(errors, null, 2)}</p>}
          </div>
        )
      }
      ```

      ```tsx {{ filename: 'app/sign-in/verify/page.tsx', collapsible: true }}
      'use client'

      import * as React from 'react'
      import { useSignIn } from '@clerk/nextjs'
      import Link from 'next/link'
      import { useRouter } from 'next/navigation'

      export default function VerifyEmailLink() {
        const { signIn } = useSignIn()
        const router = useRouter()

        const verification = signIn.emailLink.verification

        React.useEffect(() => {
          if (verification?.status !== 'verified') {
            return
          }

          // If email link verification status is 'verified', check the `signIn.status`
          void (async () => {
            // If sign-in is complete, finalize the sign-in process
            if (signIn.status === 'complete') {
              const { error } = await signIn.finalize({
                navigate: ({ decorateUrl }) => {
                  const url = decorateUrl('/')
                  if (url.startsWith('http')) {
                    window.location.href = url
                  } else {
                    router.push(url)
                  }
                },
              })
              // If `finalize` fails, check the error
              if (error) {
                console.error(JSON.stringify(error, null, 2))
              }
            } else {
              // If sign-in is not complete, redirect to the sign-in page
              router.push('/sign-in')
            }
          })()
        }, [router, signIn, signIn.status, verification?.status])

        if (!verification) {
          return <div>Loading...</div>
        }

        if (verification.status === 'failed') {
          return (
            <div>
              <h1>Verify your email</h1>
              <p>The email link verification failed.</p>
              <Link href="/sign-in">Sign in</Link>
            </div>
          )
        }

        if (verification.status === 'expired') {
          return (
            <div>
              <h1>Verify your email</h1>
              <p>The email link has expired.</p>
              <Link href="/sign-in">Sign in</Link>
            </div>
          )
        }

        // OPTIONAL: This check is only required if you have
        // the 'Require the same device and browser' setting
        // enabled in the Clerk Dashboard
        if (verification.status === 'client_mismatch') {
          return (
            <div>
              <h1>Verify your email</h1>
              <p>
                You must complete the email link sign-in on the same device and browser that you started
                it on.
              </p>
              <Link href="/sign-in">Sign in</Link>
            </div>
          )
        }

        return (
          <div>
            <h1>Verify your email</h1>
            <p>Successfully signed in. Return to the original tab to continue.</p>
          </div>
        )
      }
      ```
    </CodeBlockTabs>

    ## Add new email flow

    When a user adds an email address to their account, you can use email links to verify the email address.

    <Include src="_partials/custom-flows/email-link-verification" />
  </Steps>
</If>
