name: Pull Request Preview

env:
  API_BASE_URL: https://clerk.com
  PREVIEW_BASE_URL: https://clerk.com

on:
  push:

jobs:
  pr_preview:
    if: ${{ github.event.pull_request.head.repo.owner.login == 'clerk' }}
    runs-on: ubuntu-latest
    permissions:
      pull-requests: write
    steps:
      - name: Share PR preview URL
        uses: actions/github-script@v7
        with:
          script: |
            const branchName = context.payload.pull_request.head.ref;
            const slugifiedBranch = branchName
              .toLowerCase()
              .replace(/[^a-z0-9]/g, '-')
              .replace(/^-+|-+$/g, '');

            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: "Hey, here's your docs preview: " + process.env.PREVIEW_BASE_URL + "/docs/pr/" + slugifiedBranch,
            })
