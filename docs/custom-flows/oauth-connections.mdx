---
title: OAuth connections
description: Learn how to leverage the Clerk SDK to build completely custom OAuth flows.
---

# OAuth connections

<Callout type="danger">
  This guide is for users who want to build a *custom* user interface using the Clerk API. To authenticate users with OAuth connections using a *prebuilt* UI, you should use Clerk's [Account Portal pages](/docs/account-portal/overview) or [prebuilt components](/docs/components/overview).
</Callout>

## Before you start

You must configure your application instance through the Clerk Dashboard for the social connection(s) that you want to use, as described at [the top of the OAuth guide](/docs/authentication/social-connections/oauth#configuration).

## Create the sign-up and sign-in flow

When using OAuth, the sign-up and sign-in flows are equivalent. A successful OAuth flow consists of the following steps:

1. Start the OAuth flow by calling [`SignIn.authenticateWithRedirect(params)`](/docs/references/javascript/sign-in/authenticate-with#authenticate-with-redirect) or [`SignUp.authenticateWithRedirect(params)`](/docs/references/javascript/sign-up/authenticate-with#authenticate-with-redirect). Note that both of these methods require a `redirectUrl` param, which is the URL that the browser will be redirected to once the user authenticates with the OAuth provider.
2. Create a route at the URL that the `redirectUrl` param points to. The following example names this route `/sso-callback`. This route should call the [`Clerk.handleRedirectCallback()`](/docs/references/javascript/clerk/handle-navigation#handle-redirect-callback) method or simply render the prebuilt [`<AuthenticateWithRedirectCallback/>`](/docs/components/control/authenticate-with-callback) component.

The following example shows two files:

1. The sign-in page where the user can start the OAuth flow.
2. The SSO callback page where the OAuth flow is completed.

<Tabs items={["Next.js"]}>
  <Tab>
  <CodeBlockTabs options={["Sign in page", "SSO callback page"]}>
    ```jsx filename="app/sign-in/[[...sign-in]]/page.tsx"
    'use client';

    import * as React from 'react';
    import { OAuthStrategy } from '@clerk/types';
    import { useSignIn } from '@clerk/nextjs';

    export default function OauthSignIn() {
      const { signIn } = useSignIn();

      if (!signIn) return null;

      const signInWith = (strategy: OAuthStrategy) => {
        return signIn.authenticateWithRedirect({
          strategy,
          redirectUrl: '/sign-up/sso-callback',
          redirectUrlComplete: '/',
        });
      };

      // Render a button for each supported OAuth provider
    // you want to add to your app. This example uses only Google.
      return (
        <div>
          <button onClick={() => signInWith('oauth_google')}>
            Sign in with Google
          </button>
        </div>
      );
    }
    ```

    ```jsx filename="app/sign-up/sso-callback/page.tsx"
    import { AuthenticateWithRedirectCallback } from '@clerk/nextjs';

    export default function SSOCallback() {
      console.log('testing');
      // Handle the redirect flow by rendering the
      // prebuilt AuthenticateWithRedirectCallback component.
      // This is the final step in the custom OAuth flow.
      return <AuthenticateWithRedirectCallback />;
    }
    ```
  </CodeBlockTabs>
  </Tab>
</Tabs>

## OAuth for React Native and Expo applications

With Clerk, you can add OAuth flows in your [React Native or Expo applications](/docs/references/expo/custom-auth-flows/expo-oauth).

Clerk ensures that security critical nonces will be passed only to allowlisted URLs when the OAuth flow is complete in native browsers or webviews.

So for maximum security in your production instances, you need to allowlist your custom redirect URLs via the [Clerk Dashboard](https://dashboard.clerk.com/) or the [Clerk Backend API](/docs/references/backend/redirect-urls/create-redirect-url).

To allowlist a redirect URL via the Clerk Dashboard:
1. Navigate to the [Clerk Dashboard](https://dashboard.clerk.com/last-active?path=user-authentication/social-connections).
2. In the navigation sidebar, select **User & Authentication > Social Connections**.
3. Scroll to the **Allowlist for mobile OAuth redirect** section and add your redirect URLs.

### Expo example

The following example demonstrates a component that creates a custom OAuth flow for [Google accounts](/docs/authentication/social-connections/google).

> You can render this component in a custom sign-in or sign-up flow, which you can find examples of in [the Expo custom sign-in and sign-up flow guide](/docs/references/expo/custom-auth-flows/expo-sign-in-sign-up).

```tsx filename="components/SignInWithOAuth.tsx"
import React from "react";
import * as WebBrowser from "expo-web-browser";
import { Text, View, Button } from "react-native";
import { Link } from "expo-router";
import { useOAuth } from "@clerk/clerk-expo";

export const useWarmUpBrowser = () => {
  React.useEffect(() => {
    // Warm up the android browser to improve UX
    // https://docs.expo.dev/guides/authentication/#improving-user-experience
    void WebBrowser.warmUpAsync();
    return () => {
      void WebBrowser.coolDownAsync();
    };
  }, []);
};

WebBrowser.maybeCompleteAuthSession();

const SignInWithOAuth = () => {
  useWarmUpBrowser();

  const { startOAuthFlow } = useOAuth({ strategy: "oauth_google" });

  const onPress = React.useCallback(async () => {
    try {
      const { createdSessionId, signIn, signUp, setActive } =
        await startOAuthFlow();

      if (createdSessionId) {
        setActive!({ session: createdSessionId });
      } else {
        // Use signIn or signUp for next steps such as MFA
      }
    } catch (err) {
      console.error("OAuth error", err);
    }
  }, []);

  return (
    <View>
      <Link href="/">
        <Text>Home</Text>
      </Link>
      <Button title="Sign in with Google" onPress={onPress} />
    </View>
  );
};
export default SignInWithOAuth;
```

## OAuth account transfer flows

In some cases, a user may be trying to sign in with an OAuth account, but they don't have an account in your application yet. Or a user may be trying to sign up with an OAuth account, but they already have an account in your application. In these cases, Clerk provides "account transfers" which allow you to forward the user's information to the appropriate flow.

The following example shows how to handle these cases in your sign-in flow. The same logic can be applied to the sign-up flow; change the `signIn.AuthenticateWithRedirect()` to `signUp.authenticateWithRedirect()`.

<Tabs items={["Next.js"]}>
  <Tab>
  ```jsx filename="app/sign-in/[[...sign-in]]/page.tsx"
  'use client';

  import * as React from 'react';
  import { OAuthStrategy } from '@clerk/types';
  import { useSignIn, useSignUp } from '@clerk/nextjs';

  export default function OauthSignIn() {
    const { signIn } = useSignIn();
    const { signUp, setActive } = useSignUp();

    if (!signIn || !signUp) return null;

    async function handleSignIn(strategy: OAuthStrategy) {
      if (!signIn || !signUp) return null;

      // If the user has an account in your application, but does not yet
      // have an OAuth account connected to it, you can transfer the OAuth
      // account to the existing user account.
      const userExistsButNeedsToSignIn =
        signUp.verifications.externalAccount.status === 'transferable' &&
        signUp.verifications.externalAccount.error?.code ===
          'external_account_exists';

      if (userExistsButNeedsToSignIn) {
        const res = await signIn.create({ transfer: true });

        if (res.status === 'complete') {
          setActive({
            session: res.createdSessionId,
          });
        }
      }

      // If the user has an OAuth account but does not yet
      // have an account in your app, you can create an account
      // for them using the OAuth information.
      const userNeedsToBeCreated =
        signIn.firstFactorVerification.status === 'transferable';

      if (userNeedsToBeCreated) {
        const res = await signUp.create({
          transfer: true,
        });

        if (res.status === 'complete') {
          setActive({
            session: res.createdSessionId,
          });
        }
      } else {
        // If the user has an account in your application
        // and has an OAuth account connected to it, you can sign them in.
        signInWith(strategy);
      }
    }

    const signInWith = (strategy: OAuthStrategy) => {
      return signIn.authenticateWithRedirect({
        strategy,
        redirectUrl: '/sign-up/sso-callback',
        redirectUrlComplete: '/',
      });
    };

    // Render a button for each supported OAuth provider
    // you want to add to your app. This example uses only Google.
    return (
      <div>
        <button onClick={() => handleSignIn('oauth_google')}>
          Sign in with Google
        </button>
      </div>
    );
  }
  ```
  </Tab>
</Tabs>
