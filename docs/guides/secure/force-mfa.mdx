---
title: Force multi-factor authentication (MFA) for all users
description: Learn how to force multi-factor authentication (MFA) for all users in your Clerk application.
---

Clerk can require all users to set up multi-factor authentication (MFA) after signing in or signing up. This guide demonstrates how to enable this requirement using Clerk's `setup-mfa` [session task](!session-tasks).

<Steps>
  ## Enable MFA strategies

  First, enable the MFA strategies you want to offer to your users.

  1. In the Clerk Dashboard, navigate to the [**Multi-factor**](https://dashboard.clerk.com/~/user-authentication/multi-factor) page.
  1. Toggle on the MFA strategies you would like to enable:
     - **Authenticator application (TOTP)**: Users can use apps like Google Authenticator or Authy
     - **SMS verification code**: Users receive a one-time code via SMS

  ## Enable MFA requirement

  Once you've enabled at least one MFA strategy, you can require all users to set up MFA.

  1. On the same [**Multi-factor**](https://dashboard.clerk.com/~/user-authentication/multi-factor) page, scroll down to the **Require multi-factor authentication** section.
  1. Toggle on **Require multi-factor authentication**.

  When enabled, Clerk automatically creates a `setup-mfa` session task for:
  - New users after they sign up
  - Existing users without MFA on their next sign-in

  ## How it works

  Once the MFA requirement is enabled:

  1. Users sign in or sign up successfully
  1. If they don't have MFA set up, Clerk creates a `setup-mfa` session task
  1. The user's session enters a `pending` state and they're treated as signed-out
  1. Clerk's [`<SignIn />`](/docs/reference/components/authentication/sign-in) and [`<SignUp />`](/docs/reference/components/authentication/sign-up) components automatically display the [`<TaskSetupMfa />`](/docs/reference/components/authentication/task-setup-mfa) component
  1. After the user completes MFA setup, their session becomes `active` and they can access your application

  For more information about session tasks, see the [session tasks guide](/docs/guides/configure/session-tasks).

  ## (Optional) Customize the MFA setup page

  By default, the `<SignIn />` and `<SignUp />` components handle the MFA setup flow automatically. However, if you want to customize the route where the MFA setup page is rendered, you can host the `<TaskSetupMfa />` component on a custom page.

  <Tabs items={['Next.js', 'React', 'React Router', 'TanStack React Start']}>
    <Tab>
      First, configure the `taskUrls` option in your `ClerkProvider` to specify where the MFA setup page is located:

      ```tsx {{ filename: 'app/layout.tsx', mark: [7] }}
      import { ClerkProvider } from '@clerk/nextjs'

      export default function RootLayout({ children }: { children: React.ReactNode }) {
        return (
          <html lang="en">
            <body>
              <ClerkProvider taskUrls={{ 'setup-mfa': '/onboarding/setup-mfa' }}>
                {children}
              </ClerkProvider>
            </body>
          </html>
        )
      }
      ```

      Then, create the page at the specified route:

      ```tsx {{ filename: 'app/onboarding/setup-mfa/page.tsx' }}
      import { TaskSetupMfa } from '@clerk/nextjs'

      export default function Page() {
        return <TaskSetupMfa redirectUrlComplete="/dashboard" />
      }
      ```
    </Tab>

    <Tab>
      First, configure the `taskUrls` option in your `ClerkProvider`:

      ```tsx {{ filename: 'index.tsx', mark: [17] }}
      import React from 'react'
      import ReactDOM from 'react-dom/client'
      import App from './App.tsx'
      import { ClerkProvider } from '@clerk/react'

      const PUBLISHABLE_KEY = import.meta.env.VITE_CLERK_PUBLISHABLE_KEY

      if (!PUBLISHABLE_KEY) {
        throw new Error('Add your Clerk Publishable Key to the .env file')
      }

      ReactDOM.createRoot(document.getElementById('root')!).render(
        <React.StrictMode>
          <ClerkProvider
            publishableKey={PUBLISHABLE_KEY}
            taskUrls={{ 'setup-mfa': '/onboarding/setup-mfa' }}
          >
            <App />
          </ClerkProvider>
        </React.StrictMode>,
      )
      ```

      Then, create the page component:

      ```jsx {{ filename: 'src/onboarding/setup-mfa.tsx' }}
      import { TaskSetupMfa } from '@clerk/react'

      const SetupMfaPage = () => <TaskSetupMfa redirectUrlComplete="/dashboard" />

      export default SetupMfaPage
      ```
    </Tab>

    <Tab>
      First, configure the `taskUrls` option in your `ClerkProvider`:

      ```tsx {{ filename: 'app/root.tsx', mark: [6] }}
      import { ClerkProvider } from '@clerk/react-router'
      import { Outlet } from 'react-router'

      export default function App() {
        return (
          <ClerkProvider taskUrls={{ 'setup-mfa': '/onboarding/setup-mfa' }}>
            <Outlet />
          </ClerkProvider>
        )
      }
      ```

      Then, create the route component:

      ```tsx {{ filename: 'app/routes/onboarding/setup-mfa.tsx' }}
      import { TaskSetupMfa } from '@clerk/react-router'

      export default function SetupMfaPage() {
        return <TaskSetupMfa redirectUrlComplete="/dashboard" />
      }
      ```
    </Tab>

    <Tab>
      First, configure the `taskUrls` option in your `ClerkProvider`:

      ```tsx {{ filename: 'src/routes/__root.tsx', mark: [12] }}
      import * as React from 'react'
      import { HeadContent, Scripts } from '@tanstack/react-router'
      import { ClerkProvider } from '@clerk/tanstack-react-start'

      function RootDocument({ children }: { children: React.ReactNode }) {
        return (
          <html>
            <head>
              <HeadContent />
            </head>
            <body>
              <ClerkProvider taskUrls={{ 'setup-mfa': '/onboarding/setup-mfa' }}>
                {children}
              </ClerkProvider>
              <Scripts />
            </body>
          </html>
        )
      }
      ```

      Then, create the route:

      ```tsx {{ filename: 'src/routes/onboarding/setup-mfa.tsx' }}
      import { TaskSetupMfa } from '@clerk/tanstack-react-start'
      import { createFileRoute } from '@tanstack/react-router'

      export const Route = createFileRoute('/onboarding/setup-mfa')({
        component: SetupMfaPage,
      })

      function SetupMfaPage() {
        return <TaskSetupMfa redirectUrlComplete="/dashboard" />
      }
      ```
    </Tab>
  </Tabs>

  For more information about the `<TaskSetupMfa />` component, see the [component reference](/docs/reference/components/authentication/task-setup-mfa).
</Steps>

## Additional considerations

- **Existing users**: Users who already have accounts will be prompted to set up MFA on their next sign-in.
- **Custom flows**: If Clerk's prebuilt components don't meet your needs, you can build a custom MFA setup flow using the Clerk API. See the [custom flow guides](/docs/guides/development/custom-flows/account-updates/manage-totp-based-mfa) for more information.
  {/* TODO: Update link to setup-mfa custom flow guide once created */}
- **Session handling**: Users with pending `setup-mfa` tasks are treated as signed-out by default. Learn more about [session tasks](/docs/guides/configure/session-tasks).
