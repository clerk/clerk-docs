---
title: Next.js patterns skill
description: Advanced Next.js patterns for production apps with Clerk authentication.
---

The `nextjs-patterns` skill provides advanced patterns for production Next.js applications with Clerk. For basic setup, use the [adding-auth](/docs/guides/ai/skills/adding-auth) skill first.

## Installation

```bash
npx skills add clerk/skills --skill nextjs-patterns
```

## Example prompts

- "How do I use auth() in Server Components?"
- "Protect my Server Actions with Clerk"
- "Add user-scoped caching to my app"
- "What's the difference between auth() and useAuth()?"

## Server vs. client

### Server Components

```tsx
import { auth, currentUser } from '@clerk/nextjs/server'

// Always await auth() - it returns a Promise!
const { userId } = await auth()
const user = await currentUser()
```

### Client Components

```tsx
'use client'

import { useAuth, useUser } from '@clerk/nextjs'

// Hooks - no await needed
const { userId, isLoaded } = useAuth()
const { user, isLoaded } = useUser()
```

## Common patterns

### Protect Server Actions

```ts {{ filename: 'app/actions.ts' }}
'use server'

import { auth } from '@clerk/nextjs/server'

export async function createPost(data: FormData) {
  const { userId } = await auth()

  if (!userId) {
    throw new Error('Unauthorized')
  }

  // Safe to proceed with user's action
  return db.post.create({
    data: {
      userId,
      title: data.get('title') as string,
    },
  })
}
```

### Protect API routes

```ts {{ filename: 'app/api/posts/route.ts' }}
import { auth } from '@clerk/nextjs/server'
import { NextResponse } from 'next/server'

export async function GET() {
  const { userId } = await auth()

  if (!userId) {
    return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })
  }

  const posts = await db.post.findMany({ where: { userId } })
  return NextResponse.json(posts)
}
```

### User-scoped caching

```ts {{ filename: 'app/dashboard/page.tsx' }}
import { auth } from '@clerk/nextjs/server'
import { unstable_cache } from 'next/cache'

export default async function Dashboard() {
  const { userId } = await auth()

  // Include userId in cache key for user-specific data
  const getPosts = unstable_cache(
    async () => db.post.findMany({ where: { userId } }),
    [`posts-${userId}`],
    { tags: [`user-${userId}`] },
  )

  const posts = await getPosts()
  return <PostList posts={posts} />
}
```

### Middleware strategies

**Public-first** (recommended for most apps):

```ts {{ filename: 'middleware.ts' }}
import { clerkMiddleware, createRouteMatcher } from '@clerk/nextjs/server'

const isProtectedRoute = createRouteMatcher(['/dashboard(.*)'])

export default clerkMiddleware(async (auth, req) => {
  if (isProtectedRoute(req)) {
    await auth.protect()
  }
})
```

**Protected-first** (for apps where most routes need auth):

```ts {{ filename: 'middleware.ts' }}
import { clerkMiddleware, createRouteMatcher } from '@clerk/nextjs/server'

const isPublicRoute = createRouteMatcher(['/', '/sign-in(.*)', '/sign-up(.*)'])

export default clerkMiddleware(async (auth, req) => {
  if (!isPublicRoute(req)) {
    await auth.protect()
  }
})
```

## HTTP status codes

| Code | Meaning | When to use |
| - | - | - |
| 401 | Unauthorized | User is not authenticated |
| 403 | Forbidden | User is authenticated but lacks permission |

## Common pitfalls

- **Always `await auth()`** - the most common mistake in Server Components
- **Include API routes in matcher** - `'/(api|trpc)(.*)'`
- **User-scoped cache keys** - include `userId` in `unstable_cache` keys
- **Protect Server Actions** - always check `auth()` in mutations
- **401 vs 403** - 401 = not authenticated, 403 = authenticated but forbidden

## Related skills

- [adding-auth](/docs/guides/ai/skills/adding-auth) - Basic auth setup (start here first)
- [managing-orgs](/docs/guides/ai/skills/managing-orgs) - Organization patterns

## Source code

View the skill source on [GitHub](https://github.com/clerk/skills/tree/main/skills/nextjs-patterns).
