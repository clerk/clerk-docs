---
title: Build a custom forgot password flow
description: Build a custom forgot password flow for your users using Clerk's API.
---

# Build a custom forgot password flow

Clerk's [prebuilt components](/docs/components/overview) provide a forgot password flow for your users out of the box. However, if you want more control over the user experience, you can create a custom forgot password flow using Clerk's API.

{/* TODO: Update these Steps when the Steps component can accept other headings. As of right now, Steps can only accept H3s. */}

<Steps>

### Enable email and SMS OTP

A user can reset their password by providing their email address or phone number and then following the instructions sent to them. The instructions include a [one-time code](/docs/authentication/configuration/sign-up-sign-in-options#one-time-password-otp) that the user must then provide to complete the password reset process.

To use email and SMS OTP, you first need to enable these authentication strategies in the Clerk Dashboard.

1. Navigate to the Clerk Dashboard.
2. Go to **User & Authentication > [Email, Phone, and Username](https://dashboard.clerk.com/last-active?path=user-authentication/email-phone-username)** in the sidebar menu. 
3. In the **Authentication factors** section of this page, toggle on the **Email verification code** and **SMS verification code** strategies.

### Create the custom forgot password flow

The flow for resetting a user's password will slightly differ depending on whether the user is using their email address or phone number to reset their password. In either case, to reset a user's password, you need to:

1. Initiate the forgot password process by collecting either the user's email address or phone number.
2. Send the password reset code to the user's email address using the [`signIn.create()`](/docs/references/javascript/sign-in/sign-in#create) method with either the `reset_password_email_code` or `reset_password_phone_code` strategy.
3. Collect the new password and the password reset code from the user.
4. Attempt to complete the password reset process using the [`signIn.attemptFirstFactor()`](/docs/references/javascript/sign-in/sign-in#attemptfirstfactor) method with either the `reset_password_email_code` or `reset_password_phone_code` strategy. This method will return a [`SignIn`](/docs/references/javascript/sign-in/sign-in) object.
5. Check the created `SignIn` object's `status`.
- If `status` is `needs_second_factor`, then 2FA, or [multi-factor authentication](/docs/authentication/configuration/sign-up-sign-in-options#set-up-multi-factor-authentication), is required. You need to handle this case in your user interface.
- If `status` is `complete`, the user has successfully reset their password and a new [`Session`](/docs/references/javascript/session) is created. You can set the newly created session as the active session using the [`setActive()`](/docs/references/javascript/sign-in/sign-in#setactive) method.

In the following example, the user is asked to provide their email address. After submitting their email, the user is asked to provide a new password and the password reset code that was sent to their email. If the code is correct, the user is signed in and redirected to the home page.

Note that this example's user interface does not handle 2FA (two-factor authentication). If it detects that 2FA is needed for the account trying to reset the password, it will display a message to the user that says "2FA is required, but this UI does not handle that".

For the sake of this guide, this example is written for Next.js App Router but it is supported by any React meta framework, such as Remix or Gatsby.

{/* TODO (Roy): Wrap Next.js vs JS in Tabs instead of CodeBlockTabs. Then, use CodeBlockTabs for JS and add example for NPM Module vs window.Clerk (Script) - see the /docs/components/user-button update I did in this PR */}

<CodeBlockTabs type="framework" options={["Next.js"]}>
```tsx filename="app/forgot-password.tsx"
"use client"
import React, { useState } from 'react';
import { useAuth, useSignIn } from '@clerk/nextjs';
import type { NextPage } from 'next';
import { useRouter } from 'next/navigation';

const ForgotPasswordPage: NextPage = () => {
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [code, setCode] = useState('');
  const [successfulCreation, setSuccessfulCreation] = useState(false);
  const [secondFactor, setSecondFactor] = useState(false);
  const [error, setError] = useState('');

  const router = useRouter();
  const { isSignedIn } = useAuth();
  const { isLoaded, signIn, setActive } = useSignIn();

  if (!isLoaded) {
    return null;
  }

  // If the user is already signed in,
  // redirect them to the home page
  if (isSignedIn) {
    router.push('/');
  }

  // Send the password reset code to the user's email
  async function create(e: React.FormEvent) {
    e.preventDefault();
    await signIn
      ?.create({
        strategy: 'reset_password_email_code',
        identifier: email,
      })
      .then(_ => {
        setSuccessfulCreation(true);
        setError('');
      })
      .catch(err => {
        console.error('error', err.errors[0].longMessage);
        setError(err.errors[0].longMessage);
      });
  }

  // Reset the user's password. 
  // Upon successful reset, the user will be 
  // signed in and redirected to the home page
  async function reset(e: React.FormEvent) {
    e.preventDefault();
    await signIn
      ?.attemptFirstFactor({
        strategy: 'reset_password_email_code',
        code,
        password,
      })
      .then(result => {
        // Check if 2FA is required
        if (result.status === 'needs_second_factor') {
          setSecondFactor(true);
          setError('');
        } else if (result.status === 'complete') {
          // Set the active session to 
          // the newly created session (user is now signed in)
          setActive({ session: result.createdSessionId });
          setError('');
        } else {
          console.log(result);
        }
      })
      .catch(err => {
        console.error('error', err.errors[0].longMessage)
        setError(err.errors[0].longMessage);
      });
  }

  return (
    <div
      style={{
        margin: 'auto',
        maxWidth: '500px',
      }}
    >
      <h1>Forgot Password?</h1>
      <form
        style={{
          display: 'flex',
          flexDirection: 'column',
          gap: '1em',
        }}
        onSubmit={!successfulCreation ? create : reset}
      >
        {!successfulCreation && (
          <>
            <label htmlFor='email'>Please provide your email address</label>
            <input
              type='email'
              placeholder='e.g john@doe.com'
              value={email}
              onChange={e => setEmail(e.target.value)}
            />

            <button>Send password reset code</button>
            {error && <p>{error}</p>}
          </>
        )}

        {successfulCreation && (
          <>
            <label htmlFor='password'>Enter your new password</label>
            <input
              type='password'
              value={password}
              onChange={e => setPassword(e.target.value)}
            />

            <label htmlFor='password'>Enter the password reset code that was sent to your email</label>
            <input
              type='text'
              value={code}
              onChange={e => setCode(e.target.value)}
            />

            <button>Reset</button>
            {error && <p>{error}</p>}
          </>
        )}

        {secondFactor && <p>2FA is required, but this UI does not handle that</p>}
      </form>
    </div>
  );
};

export default ForgotPasswordPage;
```
</CodeBlockTabs>

</Steps>