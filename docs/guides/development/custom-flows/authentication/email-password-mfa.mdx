---
title: Build a custom sign-in flow with multi-factor authentication
description: Learn how to build a custom email/password sign-in flow that requires multi-factor authentication (MFA).
sdk: nextjs, react, expo, js-frontend, react-router, tanstack-react-start, ios, android
---

<Include src="_partials/custom-flows-callout" />

[Multi-factor verification (MFA)](/docs/guides/configure/auth-strategies/sign-up-sign-in-options) is an added layer of security that requires users to provide a second verification factor to access an account.

Clerk supports second factor verification through **SMS verification code**, **Authenticator application**, and **Backup codes**.

This guide will walk you through how to build a custom email/password sign-in flow that supports **Authenticator application** and **Backup codes** as the second factor.

<Steps>
  ## Enable email and password

  This guide uses email and password to sign in, however, you can modify this approach according to the needs of your application.

  To follow this guide, you first need to ensure email and password are enabled for your application.

  1. In the Clerk Dashboard, navigate to the [**User & authentication**](https://dashboard.clerk.com/last-active?path=user-authentication/user-and-authentication) page.
  1. Enable **Sign-in with email**.
  1. Select the **Password** tab and enable **Sign-up with password**. Leave **Require a password at sign-up** enabled.

  ## Enable multi-factor authentication

  For your users to be able to enable MFA for their account, you need to enable MFA for your application.

  1. In the Clerk Dashboard, navigate to the [**Multi-factor**](https://dashboard.clerk.com/last-active?path=user-authentication/multi-factor) page.
  1. For the purpose of this guide, toggle on both the **Authenticator application** and **Backup codes** strategies.
  1. Select **Save**.

  ## Sign-in flow

  Signing in to an MFA-enabled account is identical to the regular sign-in process. However, in the case of an MFA-enabled account, a sign-in won't convert until both first factor and second factor verifications are completed.

  To authenticate a user using their email and password, you need to:

  <If sdk={["nextjs", "react", "expo", "js-frontend", "react-router", "tanstack-react-start"]}>
    1. Initiate the sign-up process by collecting the user's email address and password with the [`signIn.password()`](/docs/reference/javascript/sign-in-future#password) method.
    1. Collect the TOTP code and verify it with the [`signIn.mfa.verifyTOTP()`](/docs/reference/javascript/sign-in-future#mfa-verify-totp) method.
    1. If the TOTP verification is successful, finalize the sign-in with the [`signIn.finalize()`](/docs/reference/javascript/sign-in-future#finalize) method to set the newly created session as the active session.

    > [!TIP]
    > For this example to work, the user must have MFA enabled on their account. You need to add the ability for your users to manage their MFA settings. See the [manage SMS-based MFA](/docs/guides/development/custom-flows/account-updates/manage-sms-based-mfa) or the [manage TOTP-based MFA](/docs/guides/development/custom-flows/account-updates/manage-totp-based-mfa) guide, depending on your needs.

    <Tabs items={["Next.js"]}>
      <Tab>
        <Include src="_partials/custom-flows/email-password-mfa/sign-in-nextjs" />
      </Tab>
    </Tabs>
  </If>

  <If sdk={["ios", "android"]}>
    1. Initiate the sign-in process by collecting the user's email address and password.
    1. Prepare the first factor verification.
    1. Attempt to complete the first factor verification.
    1. Prepare the second factor verification. (This is where MFA comes into play.)
    1. Attempt to complete the second factor verification.
    1. If the verification is successful, set the newly created session as the active session.

    > [!TIP]
    > For this example to work, the user must have MFA enabled on their account. You need to add the ability for your users to manage their MFA settings. See the [manage SMS-based MFA](/docs/guides/development/custom-flows/account-updates/manage-sms-based-mfa) or the [manage TOTP-based MFA](/docs/guides/development/custom-flows/account-updates/manage-totp-based-mfa) guide, depending on your needs.

    <Tabs items={["iOS", "Android"]}>
      <Tab>
        <Include src="_partials/custom-flows/email-password-mfa/sign-in-nextjs" />
      </Tab>

      <Tab>
        <Include src="_partials/custom-flows/email-password-mfa/sign-in-ios" />
      </Tab>

      <Tab>
        <Include src="_partials/custom-flows/email-password-mfa/sign-in-android" />
      </Tab>
    </Tabs>
  </If>
</Steps>

{/* TODO: Add logic for MFA for phone code */}

## Next steps

Now that users can sign in with MFA, you need to add the ability for your users to manage their MFA settings. Learn how to build a custom flow for [managing TOTP MFA](/docs/guides/development/custom-flows/account-updates/manage-totp-based-mfa) or for [managing SMS MFA](/docs/guides/development/custom-flows/account-updates/manage-sms-based-mfa).
