---
title: Integrate Prisma Postgres with Clerk
description: Learn how to integrate Clerk into your Prisma Postgres application.
---

<TutorialHero
  beforeYouStart={[
    {
      title: "Set up a Clerk application",
      link: "/docs/quickstarts/setup-clerk",
      icon: "clerk",
    }
  ]}
/>

This tutorial shows you how to build a Next.js application with Clerk authentication and Prisma Postgres. You'll create a simple messaging app where users can store and manage their personal messages using Prisma ORM for database operations.

<Steps>
  ## Create a new Next.js project

  1. Create a new Next.js project using the following command:
     ```sh {{ filename: 'terminal' }}
     npx create-next-app clerk-prisma-example --typescript --eslint --tailwind --use-npm --no-src-dir --app --import-alias "@/*"
     ```
  1. Navigate to the project directory and install the required dependencies:
     ```sh {{ filename: 'terminal' }}
     cd clerk-prisma-example
     npm install prisma --save-dev
     npm install tsx --save-dev
     npm install @prisma/extension-accelerate
     ```

  ## Integrate the Next.js Clerk SDK

  Follow the [Next.js quickstart](/docs/quickstarts/nextjs) to integrate the Clerk Next.js SDK into your application.

  ## Protect your application routes

  To ensure that only authenticated users can access your application, modify [`clerkMiddleware`](/docs/references/nextjs/clerk-middleware) to require authentication for every route.

  ```typescript {{ filename: 'middleware.ts', mark: [[3, 5]] }}
  import { clerkMiddleware } from '@clerk/nextjs/server'

  export default clerkMiddleware(async (auth) => {
    await auth.protect()
  })

  export const config = {
    matcher: [
      // Skip Next.js internals and all static files, unless found in search params
      '/((?!_next|[^?]*\\.(?:html?|css|js(?!on)|jpe?g|webp|png|gif|svg|ttf|woff2?|ico|csv|docx?|xlsx?|zip|webmanifest)).*)',
      // Always run for API routes
      '/(api|trpc)(.*)',
    ],
  }
  ```

  ## Set up the application schema and database connection

  Next, you'll need to initialize Prisma and set up a Prisma Postgres database.

  1. Initialize Prisma in your project:
     ```sh {{ filename: 'terminal' }}
     npx prisma init --output ../app/generated/prisma
     ```

  After initializing Prisma, your environment variable file should have the following values:

  ```env {{ filename: '.env' }}
  DATABASE_URL=PRISMA_POSTGRES_CONNECTION_STRING
  NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY={{pub_key}}
  CLERK_SECRET_KEY={{secret}}
  ```

  1. Create a `schema.prisma` file in the `prisma/` directory that defines the database schema. The schema will include a table called `user_messages` with the columns `user_id`, `create_ts`, and `message`. The `user_id` column will be used to store the user's Clerk ID.

     ```prisma {{ filename: 'prisma/schema.prisma' }}
     generator client {
       provider = "prisma-client-js"
       output   = "../app/generated/prisma"
     }

     datasource db {
       provider = "postgresql"
       url      = env("DATABASE_URL")
     }

     model UserMessage {
       user_id   String   @id
       create_ts DateTime @default(now())
       message   String
     }
     ```

  1. Create a reusable Prisma Client instance in `lib/prisma.ts`:

     ```typescript {{ filename: 'lib/prisma.ts' }}
     import { PrismaClient } from '../app/generated/prisma'

     const globalForPrisma = globalThis as unknown as {
       prisma: PrismaClient | undefined
     }

     export const prisma = globalForPrisma.prisma ?? new PrismaClient()

     if (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma

     export default prisma
     ```

  ## Push the schema to the database

  Run the following command to push the schema to the database:

  ```sh {{ filename: 'terminal' }}
  npx prisma db push
  ```

  ## Create Server Actions to handle user interactions

  To handle form submissions for adding and deleting user messages, create two Server Actions in `app/actions.ts`. Use Clerk's [`auth()` helper](/docs/references/nextjs/auth) to obtain the user ID, which will be used to interact with the database.

  ```typescript {{ filename: 'app/actions.ts' }}
  'use server'

  import { auth } from '@clerk/nextjs/server'
  import prisma from '@/lib/prisma'

  export async function createUserMessage(formData: FormData) {
    const { userId } = await auth()
    if (!userId) throw new Error('User not found')

    const message = formData.get('message') as string
    await prisma.userMessage.create({
      data: {
        user_id: userId,
        message,
      },
    })
  }

  export async function deleteUserMessage() {
    const { userId } = await auth()
    if (!userId) throw new Error('User not found')

    await prisma.userMessage.deleteMany({
      where: { user_id: userId },
    })
  }
  ```

  ## Create the UI for the Home Page

  In your `app/page.tsx` file, add the following code to create the UI for the home page. If a message exists, the user can view and delete it; otherwise, they can add a new message.

  To retrieve the user's messages, use Clerk's [`auth()` helper](/docs/references/nextjs/auth) to obtain the user's ID. Then, use this ID to query the database for the user's messages.

  To enable the user to delete or add a message, use the `deleteUserMessage()` and `createUserMessage()` actions created in the previous step.

  ```tsx {{ filename: 'app/page.tsx' }}
  import { createUserMessage, deleteUserMessage } from './actions'
  import prisma from '@/lib/prisma'
  import { auth } from '@clerk/nextjs/server'

  export default async function Home() {
    const { userId } = await auth()
    if (!userId) throw new Error('User not found')
    const existingMessage = await prisma.userMessage.findUnique({
      where: { user_id: userId },
    })

    return (
      <main>
        <h1>Prisma + Clerk Example</h1>
        {existingMessage ? (
          <div>
            <p>{existingMessage.message}</p>
            <form action={deleteUserMessage}>
              <button>Delete Message</button>
            </form>
          </div>
        ) : (
          <form action={createUserMessage}>
            <input type="text" name="message" placeholder="Enter a message" />
            <button>Save Message</button>
          </form>
        )}
      </main>
    )
  }
  ```

  ## Run the application

  Run your application and open `http://localhost:3000` in your browser. Sign in with Clerk and interact with the application to add and delete user messages.
</Steps>
